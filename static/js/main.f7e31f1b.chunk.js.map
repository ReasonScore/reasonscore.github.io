{"version":3,"sources":["../../src/index.ts","../../src/newId.ts","../../../src/dataModels/Score.ts","../../../src/dataModels/Action.ts","../../../src/dataModels/RsData.ts","../../../../src/repositories/reducers/IndexReducer.ts","../../src/calculateScore.ts","../../../src/repositories/RepositoryLocalPure.ts","../../../src/dataModels/Claim.ts","../../../src/dataModels/ClaimEdge.ts","../../../src/dataModels/ScoreTree.ts","../../src/Messenger.ts","../../src/calculateScoreActions.ts","../../../src/utils/hasItemChanged.ts","../../../../src/repositories/reducers/claims.ts","../../../../src/repositories/reducers/claimEdges.ts","../../../src/repositories/RepositoryLocalBase.ts","../../../../src/repositories/reducers/scores.ts","../../../../src/repositories/reducers/scoresTrees.ts","../../../src/utils/deepClone.ts","../../../src/utils/selectNode.ts","dataModels/ClaimEdge.ts","dataModels/Claim.ts","EditorElement.tsx","selectElement.ts","BucketElement.tsx","creatMarkup.tsx","ScoreElement.tsx","utils/searchTools.ts","SearchElement.tsx","Menu.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["when","decimal","s","split","result","Math","Array","constructor","parentScoreId","sourceEdgeId","reversible","pro","affects","confidence","relevance","id","priority","content","scaledWeight","sourceClaimId","scoreTreeId","dataId","newData","oldData","type","this","actionsLog","items","claimEdgeIdsByParentId","claimEdgeIdsByChildId","scoreIdsBySourceId","childIdsByScoreId","ScoreTreeIds","state","calcWeight","score","childScores","newScore","maxChildWeight","childScore","polarity","Object","rsData","RsData","notify","actions","claims","claimEdges","scores","scoreTrees","RepositoryLocalBase","parentId","childId","descendantCount","topScoreId","subscriber","subscribe","unsubscribe","index","subscribers","indexOf","callback","repository","RepositoryLocalPure","calculator","calculateScore","scoreActions","claimIdsToScore","action","scoreTemp","claimEdge","claimEdgeTemp","Action","oldClaimEdge","scoreTree","claimScore","missingScoreActions","mainScore","Score","createBlankMissingScores","scoreTreeActions","calculateScoreDescendants","newMainScore","fractionActions","calculateFractions","generationActions","calculateGenerations","newScoreTreePartial","oldScoreTreePartial","edges","edge","u","currentScore","oldChildScores","newChildScores","newDescendantCount","newScoreFragment","newChildScore","oldChildScore","hasItemChanged","parentScore","totalRelevance","oldScore","fractionSimple","fraction","generation","scoreA","JSON","checkResult","itemChanges","newItem","partialOldItem","partialNewItem","oldItem","Claim","ClaimEdge","IndexReducer","IndexDelete","scoreIds","internalIndex","location","getClaim","getClaimEdge","getScore","getScoreTree","getClaimEdgesByParentId","claimEdgeIdStrings","getClaimEdgesByChildId","getScoresBySourceId","scoreIdStrings","getChildrenByScoreId","childIdStrings","getDescendantScoresById","scoresToProcess","ScoreTree","selectedId","itemId","status","newId","checked","labelMin","labelMid","labelMax","EditorElement","props","handleSubmit","pasteClaim","push","undefined","claim","new","calculateScoreActions","then","a","messenger","concat","handleEditClose","handleText","e","pathParts","currentTarget","length","setState","value","Error","handlePriority","handlePasteClaim","handlePro","proMain","proMainContext","handleProMain","handleDelete","handleCancel","newState","claimId","parse","stringify","className","htmlFor","onChange","rows","href","role","aria-label","onClick","disabled","scoreId","React","Component","selectElement","settings","selectedNodes","selectNode","expander2s","window","document","getElementsByClassName","expander2","expander3","getElementById","replace","selectedNode","find","substring","selectedOnly","BucketElement","p","percentage","style","height","commonmark","require","createMarkup","fractionalizedScore","sign","Mustache","render","reader","Parser","writer","HtmlRenderer","safe","parsed","html","__html","ScoreElement","handleChildrenVisible","handleDataDispatch","change","childrenVisible","handleEditButtonClick","editorVisible","addMode","handleAddButtonClick","claimResult","scoreNumber","round","scoreNumberText","toLocaleString","minimumFractionDigits","maximumFractionDigits","toString","padStart","scoreDescription","scoreDescriptions","descriptions","trailing","impact","descItem","min","desc","basedOn","childScoresSorted","sort","b","proMainText","abs","toFixed","scoreUrl","URL","searchParams","set","scoreUrlText","encodeURIComponent","width","title","left","viewBox","d","showFractionalized","showScore","showBucket","dangerouslySetInnerHTML","target","marginBottom","weight","CSSTransition","in","timeout","classNames","TransitionGroup","component","map","child","InstantSearch","container","tokens","defaultClassName","defaultCaseSensitivity","m_container","m_defaultClassName","m_defaultCaseSensitivity","m_highlightTokens","iterator","bind","checkAndReplace","highlight","highlightNode","token","sensitiveSearch","node","nodeVal","nodeValue","parentNode","textNode","i","j","curToken","textToHighlight","highlightClassName","caseSensitive","isFirst","foundIndex","toLowerCase","createTextNode","insertBefore","removeChild","begin","matched","substr","span","createElement","classList","contains","add","appendChild","children","prototype","slice","call","childNodes","cur","nodeType","Node","TEXT_NODE","ELEMENT_NODE","n","SearchIndex","Fuse","includeScore","shouldSort","includeMatches","findAllMatches","minMatchCharLength","useExtendedSearch","ignoreLocation","keys","indexPopulated","SearchElement","mainScoreId","useState","searchText","setSearchText","foundClaims","setFoundClaims","forcedRender","forceRender","searchResults","search","searchResult","foundWord","getFoundWord","matches","item","random","handleOpenButtonClick","scoreid","scrollIntoView","word","wordLengthDifference","indices","tempWord","tempWordLengthDiff","useEffect","elements","querySelectorAll","element","getAttribute","data-highlight","opacity","Menu","handleSave","rsDataCleanedForTransfer","getRsDataCleanedForTransfer","RsDatabase","doc","dbCollection","tempVisualLog","Date","rsDataWithtouUndefined","handleImport","innerHTML","fileInput","firstChild","that","addEventListener","files","file","name","match","FileReader","onload","updatedScores","setTimeout","readAsText","alert","click","handleExport","showSaveFilePicker","fileHandle","createWritable","writable","write","close","confirm","hiddenElement","encodeURI","download","toggleSettings","settingsOpen","handleSetting","setting","numbers","lines","hideMainScore","selectId","startClosed","classes","maxWidth","margin","padding","DbNotAvailable","editable","saveToCloud","portData","cursor","fill","stroke","transform","display","App","Boolean","hostname","RsRepository","RsMessenger","Messenger","RsSettings","RsCalculateScoreActions","RsActions","get","exists","data","scoreElements","getElementsByTagName","scoreElement","possibleScoreId","ReactDOM","rsStartApp","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.f7e31f1b.chunk.js","sourcesContent":["export * from \"./calculateScore\";\r\nexport * from \"./Messenger\";\r\nexport * from \"./newId\";\r\nexport * from \"./calculateScoreActions\";\r\nexport * from \"./repositories/RepositoryLocalPure\"\r\nexport * from \"./utils/deepClone\"\r\nexport * from \"./utils/selectNode\"\r\n\r\n// Data Models\r\nexport * from \"./dataModels/Action\";\r\nexport * from \"./dataModels/ActionTypes\";\r\nexport * from \"./dataModels/Affects\";\r\nexport * from \"./dataModels/Item\";\r\nexport * from \"./dataModels/ItemTypes\";\r\nexport * from \"./dataModels/ClaimEdge\";\r\nexport * from \"./dataModels/RsData\";\r\nexport * from \"./dataModels/Score\";\r\nexport * from \"./dataModels/ScoreTree\";\r\nexport * from \"./dataModels/Claim\";\r\n","\r\nexport function newId(when: Date = new Date()): string {\r\n  // take the UTC date and convert to base 62\r\n  let decimal = 5000000000000 - when.getTime();\r\n  const s = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');\r\n  let result = '';\r\n  while (decimal >= 1) {\r\n    result = s[(decimal - (62 * Math.floor(decimal / 62)))] + result;\r\n    decimal = Math.floor(decimal / 62);\r\n  }\r\n\r\n  // Add 5 extra random characters in case multiple ids are creates at the same time\r\n  result += Array(5).join().split(',').map(() => s[(Math.floor(Math.random() * s.length))])\r\n    .join('');\r\n\r\n  return result ;\r\n}","import { newId } from \"../newId\";\r\nimport { Affects } from \"./Affects\";\r\nimport { Item } from \"./Item\";\r\nimport { ItemTypes } from \"..\";\r\n/**\r\n * Stores the score for a claim. Just a data transfer object. Does not contain any logic.\r\n */\r\nexport class Score implements Item {\r\n    type: ItemTypes = 'score'\r\n\r\n    constructor(\r\n        /** The claim to which this score belongs */\r\n        public sourceClaimId: string,\r\n        /** The top of the tree of scores that this belongs to. Used for indexing */\r\n        public scoreTreeId: string,\r\n        /** The parent of this score in the score tree graph */\r\n        public parentScoreId: string | null = null, // Use null because Firestore does not allow undefined\r\n        /** The Edge to which this score belongs */\r\n        public sourceEdgeId: string | null = null,\r\n\r\n        public reversible: boolean = false,\r\n        /** Is this score a pro of it's parent (false if it is a con) */\r\n        public pro: boolean = true,\r\n        /** how confident we sould be in the claim. (AKA True) */\r\n        /** How the child affects the parent score */\r\n        public affects: Affects = \"confidence\",\r\n        public confidence: number = 1,\r\n        /** How relevent this claim is to it's parent claim. Ranges from 0 to infinity.\r\n         * A multiplier set by all the child edges that affect 'relevance'*/\r\n        public relevance: number = 1,\r\n        public id: string = newId(),\r\n        public priority: string = \"\",\r\n        public content: string = \"\",\r\n        /** the impact/weight of this score on it's parent score but scaled so all the children are less than 1  */\r\n        public scaledWeight: number = 0,\r\n    ) {\r\n    }\r\n\r\n    public descendantCount: number = 0;\r\n    public generation: number = 0;\r\n\r\n    /** What fraction of tree is this disregarding all scores */\r\n    public fractionSimple: number = 1;\r\n    /** What fraction of mainScore is this score and it's descendants responsible for */\r\n    public fraction: number = 1;\r\n\r\n    public childrenAveragingWeight: number = 1;\r\n    public childrenConfidenceWeight: number = 1;\r\n    public childrenRelevanceWeight: number = 1;\r\n    public childrenWeight: number = 1;\r\n    public weight: number = 1;\r\n    public percentOfWeight: number = 1;\r\n\r\n    // //TODO:Experimental\r\n    // public childrenProWeight: number = 0;\r\n    // public childrenConWeight: number = 0;\r\n    // public percentAgreeWeight: number = 0;\r\n    // public parentFractionSimple: number = 0;\r\n}\r\n\r\n","import { ActionTypes } from \"./ActionTypes\";\r\n\r\nexport class Action {\r\n    constructor(\r\n        public newData: any,\r\n        public oldData: any,\r\n        public type: ActionTypes,\r\n        public dataId: string = \"\",\r\n    ) {\r\n        if (dataId === \"\") {\r\n            this.dataId = newData.id\r\n        }\r\n    }\r\n}","import { Action } from \"./Action\";\r\nimport { Item } from \"./Item\";\r\n\r\nexport interface Index { [searchIndex: string]: string; } //Store the string for the ID\r\nexport interface IndexArray { [searchIndex: string]: string[]; } //Store the string for the ID\r\n\r\nexport class RsData implements RsData {\r\n    constructor(\r\n        public actionsLog: { actions: Action[] }[] = [],\r\n        // Claim data\r\n        /** Stores all the current items */\r\n        public items: { [idString: string]: Item; } = {},\r\n\r\n        // Claim Indexes - Local\r\n        public claimEdgeIdsByParentId: IndexArray = {},\r\n        public claimEdgeIdsByChildId: IndexArray = {},\r\n\r\n        //Score Indexes - Local\r\n        public scoreIdsBySourceId: IndexArray = {},\r\n        public childIdsByScoreId: IndexArray = {},\r\n        public ScoreTreeIds: string[] = [],\r\n    ) {\r\n    }\r\n}\r\n","import { RsData } from \"../../dataModels/RsData\";\r\nexport function IndexReducer(state: any, index: string, keyId: string | null | undefined, id: string): RsData {\r\n    if (keyId) {\r\n        //TODO: remove this, can I use \"...state[index][keyId] || []\" below?\r\n        if (!state[index][keyId]) {\r\n            state[index][keyId] = [];\r\n        }\r\n        if (state[index][keyId].indexOf(id) == -1) {\r\n            state = {\r\n                ...state,\r\n                [index]: {\r\n                    ...state[index],\r\n                    [keyId]: [\r\n                        ...state[index][keyId],\r\n                        id\r\n                    ]\r\n                }\r\n            };\r\n        }\r\n    }\r\n    return state;\r\n}\r\n","import { Score } from \"./dataModels/Score\";\r\n\r\nexport interface iCalculateScore {\r\n    ({ childScores }: {\r\n        /** An array of grouped edges and claims*/\r\n        childScores?: Score[];\r\n    }): Partial<Score>\r\n}\r\n\r\n/**\r\n * Calculates a new score based on the child scores passed in.\r\n */\r\nexport function calculateScore({ childScores = [], reversible = true }: {\r\n    /** An array of grouped edges and claims*/\r\n    childScores?: Score[];\r\n    /** Can this score fall below a 0 confidence (have a negative confidence) */\r\n    reversible?: boolean\r\n} = {},\r\n): Partial<Score> {\r\n    // TODO: Simplify all this math and maybe break it up between base functionality and additional scoring (like the points)\r\n    const newScore: Partial<Score> = {};\r\n    newScore.confidence = 0;\r\n    newScore.relevance = 1;\r\n    newScore.childrenAveragingWeight = 0;\r\n    newScore.childrenConfidenceWeight = 0;\r\n    newScore.childrenRelevanceWeight = 0;\r\n    newScore.childrenWeight = 0;\r\n    // newScore.childrenProWeight = 0;\r\n    // newScore.childrenConWeight = 0;\r\n\r\n    let maxChildWeight = 0\r\n\r\n\r\n    if (childScores.filter(s => s.affects === 'confidence').length < 1) {\r\n        // Defaults if there are no children\r\n        newScore.confidence = 1; // assume 100% confident\r\n        newScore.relevance = 1; // assume 100% relevant\r\n        newScore.childrenAveragingWeight = 1;\r\n        newScore.childrenConfidenceWeight = 1;\r\n        newScore.childrenRelevanceWeight = 1;\r\n        newScore.childrenWeight = 1;\r\n        newScore.weight = 1;\r\n    }\r\n\r\n    //Gather children Weights totals for processing further down\r\n    for (const childScore of childScores) {\r\n        // //Ensure calculations for non-reversible scores don't allow the confidence to be below 0\r\n        // //TODO: Is this needed in the totals seciton?\r\n        // let confidence = childScore.confidence\r\n        // if (!childScore.reversible && childScore.confidence < 0) {\r\n        //     confidence = 0\r\n        // }\r\n\r\n        childScore.weight = calcWeight(childScore); //TODO: Just in case a child score comes in uncalculated - maybe should be removed\r\n        newScore.childrenAveragingWeight += 1;\r\n        newScore.childrenConfidenceWeight += Math.abs(childScore.confidence);\r\n        newScore.childrenRelevanceWeight += childScore.relevance;\r\n        newScore.childrenWeight += childScore.weight;\r\n        if (childScore.weight > maxChildWeight){\r\n            maxChildWeight = childScore.weight;\r\n        }\r\n\r\n        // //TODO: Experimantal\r\n        // if (confidence > 0) {\r\n        //     if (childScore.pro) {\r\n        //         newScore.childrenProWeight += confidence\r\n        //     }\r\n        //     if (!childScore.pro) {\r\n        //         newScore.childrenConWeight += confidence\r\n        //     }\r\n        // } else if (confidence < 0) {\r\n        //     if (childScore.pro) {\r\n        //         newScore.childrenConWeight += confidence\r\n        //     }\r\n        //     if (!childScore.pro) {\r\n        //         newScore.childrenProWeight += confidence\r\n        //     }\r\n        // }\r\n    }\r\n\r\n    // Loop through to calculate the final scores\r\n    for (const childScore of childScores) {\r\n        const polarity = childScore.pro ? 1 : -1\r\n\r\n        if (childScore.affects === \"confidence\") {\r\n            if (newScore.childrenWeight === 0) {\r\n                childScore.percentOfWeight = 0;\r\n                newScore.confidence = 0;\r\n            } else {\r\n\r\n                childScore.percentOfWeight =\r\n                    childScore.weight /\r\n                    newScore.childrenWeight;\r\n\r\n                newScore.confidence +=\r\n                    childScore.percentOfWeight *\r\n                    childScore.confidence * polarity;\r\n            }\r\n        }\r\n\r\n        if (childScore.affects === \"relevance\") {\r\n            // Process Relevance child claims\r\n\r\n            let confidence = childScore.confidence\r\n            if (!childScore.reversible && childScore.confidence < 0) {\r\n                confidence = 0\r\n            }\r\n\r\n            if (newScore.relevance == undefined) {\r\n                newScore.relevance = 1;\r\n            }\r\n\r\n            if (childScore.pro) {\r\n                newScore.relevance += confidence;\r\n            } else {\r\n                newScore.relevance -= confidence / 2;\r\n            }\r\n        }\r\n\r\n        // if (childScore.pro) {\r\n        //     childScore.percentAgreeWeight = confidence / newScore.childrenProWeight\r\n        // } else {\r\n        //     childScore.percentAgreeWeight = confidence / newScore.childrenConWeight\r\n        // }\r\n\r\n        childScore.scaledWeight = (childScore.weight/maxChildWeight)\r\n\r\n    }\r\n\r\n\r\n    if (Object.is(newScore.confidence, -0)) {\r\n        // Protect against negative zero \r\n        newScore.confidence = 0;\r\n    }\r\n\r\n    let confidence = Math.abs(newScore.confidence)\r\n    if (!newScore.reversible && newScore.confidence < 0) {\r\n        confidence = 0\r\n    }\r\n\r\n    newScore.weight = calcWeight(newScore);\r\n    newScore.scaledWeight = newScore.weight;\r\n\r\n    return newScore;\r\n}\r\n\r\nfunction calcWeight(score: Partial<Score>) {\r\n    if (score.confidence !== undefined && score.relevance !== undefined){\r\n        let confidence = Math.abs(score.confidence)\r\n        if (!score.reversible && score.confidence < 0) {\r\n            confidence = 0\r\n        }\r\n        return confidence * score.relevance;\r\n    } else {\r\n        return 1;\r\n    }\r\n}\r\n","import { Action } from \"../dataModels/Action\";\r\nimport { RsData } from \"../dataModels/RsData\";\r\nimport { iRepository } from \"../dataModels/iRepository\";\r\nimport { claims } from \"./reducers/claims\";\r\nimport { claimEdges } from \"./reducers/claimEdges\";\r\nimport { RepositoryLocalBase } from \"./RepositoryLocalBase\";\r\nimport { scores } from \"./reducers/scores\";\r\nimport { scoreTrees } from \"./reducers/scoresTrees\";\r\n\r\n\r\nexport class RepositoryLocalPure extends RepositoryLocalBase implements iRepository {\r\n\r\n    constructor(\r\n        public rsData: RsData = new RsData()\r\n    ) {\r\n        super(rsData);\r\n    }\r\n\r\n    async notify(actions: Action[]) {\r\n        this.rsData.actionsLog.push({actions:actions}); //TODO: put logs back in\r\n        for (const action of actions) {\r\n            this.rsData = claims(this.rsData, action);\r\n            this.rsData = claimEdges(this.rsData, action);\r\n            this.rsData = scores(this.rsData, action);\r\n            this.rsData = scoreTrees(this.rsData, action);\r\n        }\r\n    }\r\n\r\n}","import { ItemTypes } from \"./ItemTypes\";\r\nimport { newId } from \"../newId\";\r\nimport { Item } from \"./Item\";\r\n\r\nexport class Claim implements Item {\r\n    type: ItemTypes = 'claim'\r\n\r\n    constructor(\r\n        public content: string = \"\",\r\n        public id: string = newId(),\r\n        public reversible: boolean = false,\r\n    ) {\r\n    }\r\n}\r\n","import { Affects } from \"./Affects\"\r\nimport { ItemTypes } from \"./ItemTypes\";\r\nimport { newId } from \"../newId\";\r\n/**\r\n * Stores the relationship between a claim and an item (usually another claim).\r\n * This is directional as the edge points from one claim to it's parent.\r\n * This is just a data transfer object so it should have no logic in it\r\n * and only JSON compatible types string, number, object, array, boolean\r\n */\r\nexport class ClaimEdge {\r\n    type: ItemTypes = 'claimEdge'\r\n\r\n    constructor(\r\n        /** The ID for the parent claim this edge points to */\r\n        public parentId: string,\r\n        /** The ID for the child claim this edge points from */\r\n        public childId: string,\r\n        /** How the child affects the parent score */\r\n        public affects: Affects = 'confidence',\r\n        /** Is the child claim a pro of it's parent (false if it is a con) */\r\n        public pro: boolean = true,\r\n        public id: string = newId(),\r\n        public priority: string = \"\",\r\n    ) {\r\n    }\r\n}\r\n","import { newId } from \"../newId\";\r\nimport { Item } from \"./Item\";\r\nimport { ItemTypes } from \"..\";\r\n/**\r\n * Represents an intentional top of a tree of scores.\r\n */\r\nexport class ScoreTree implements Item {\r\n    type: ItemTypes = 'scoreTree'\r\n\r\n    constructor(\r\n        /** The claim to which this score belongs */\r\n        public sourceClaimId: string,\r\n        /** The top of the tree of scores that this belongs to. Used for indexing */\r\n        public topScoreId: string,\r\n        /** how confident we sould be in the claim. (AKA True) */\r\n        public confidence: number = 1,\r\n        public id: string = newId(),\r\n        public descendantCount: number = 0,\r\n    ) {\r\n    }\r\n}","import { Action } from \"./dataModels/Action\";\r\n\r\nexport class Messenger {\r\n    public readonly subscribers: { (changes: Action[]): void; }[] = []\r\n    public readonly actionsLog: Action[][] = [];\r\n\r\n    subscribe(callback: (actions: Action[]) => void): void {\r\n        this.subscribers.push(callback)\r\n    }\r\n\r\n    unsubscribe(callback: (actions: Action[]) => void): void {\r\n        const index = this.subscribers.indexOf(callback, 0);\r\n        if (index > -1) {\r\n            this.subscribers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    /** this function can be called by outside code to notfy this repository of changes */\r\n    notify = (actions: Action[]) => {\r\n        this.actionsLog.push(actions);\r\n        for (const subscriber of this.subscribers) {\r\n            subscriber(actions);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n","import { Score } from \"./dataModels/Score\";\r\nimport { hasItemChanged } from \"./utils/hasItemChanged\";\r\nimport { Action } from \"./dataModels/Action\";\r\nimport { iCalculateScore, calculateScore } from \"./calculateScore\";\r\nimport { iRepository } from \"./dataModels/iRepository\";\r\nimport { ClaimEdge } from \"./dataModels/ClaimEdge\";\r\nimport { RepositoryLocalPure } from \"./repositories/RepositoryLocalPure\";\r\nimport { ScoreTree } from \".\";\r\n\r\n/**\r\n * Calculates the score actions based on a list of actions\r\n */\r\nexport async function calculateScoreActions({ actions = [], repository = new RepositoryLocalPure(), calculator = calculateScore }: {\r\n    /** An array of actions, usually on claims or edges that incluse no scores*/\r\n    actions?: Action[];\r\n    /** The repository used to get context for the actions */\r\n    repository?: iRepository;\r\n    /** The function used to calculate the scores */\r\n    calculator?: iCalculateScore;\r\n} = {},\r\n) {\r\n    const scoreActions: Action[] = [];\r\n    const claimIdsToScore: string[] = [];\r\n    const ScoreTreeIds: string[] = [];\r\n\r\n    await repository.notify(actions);\r\n    for (const action of actions) {\r\n\r\n        // find claims that may need scores changed\r\n        if (action.type == 'add_claim' || action.type == 'modify_claim') {\r\n            claimIdsToScore.push(action.dataId)\r\n        }\r\n\r\n        if (action.type == \"add_score\") {\r\n            let score = action.newData as Score;\r\n            if (!score.parentScoreId) {\r\n                const scoreTemp = await repository.getScore(action.dataId)\r\n                if (scoreTemp) {\r\n                    score = scoreTemp;\r\n                }\r\n            }\r\n\r\n            claimIdsToScore.push(score.sourceClaimId)\r\n        }\r\n\r\n        //Add scores if edges adds new children to claims in score trees\r\n        if (action.type == 'add_claimEdge' || action.type == 'modify_claimEdge') {\r\n            let claimEdge = action.newData as ClaimEdge;\r\n            if (!claimEdge.parentId) {\r\n                const claimEdgeTemp = await repository.getClaimEdge(action.dataId)\r\n                if (claimEdgeTemp) {\r\n                    claimEdge = claimEdgeTemp;\r\n                }\r\n            }\r\n            claimIdsToScore.push(claimEdge.parentId)\r\n        }\r\n\r\n        //TODO: If an edge changes then modify the existing scores to match\r\n        if (action.type == 'modify_claimEdge') {\r\n            let claimEdge = await repository.getClaimEdge(action.dataId)\r\n            claimEdge = { ...claimEdge, ...action.newData }\r\n            if (claimEdge) {\r\n                action.newData as ClaimEdge;\r\n                const scores = await repository.getScoresBySourceId(claimEdge.id)\r\n                for (const score of scores) {\r\n                    //TODO: Where should I put this? It is modifying am object. If it is reactive i should just change the data. If pure it should be a new object.\r\n                    //For now I will modify it but it may not trigger updates in a pure library (React)\r\n                    //This change should also probably be centralized somewhere to reduce the chance of inconsistent bugs. I think it will happen in multiple paces\r\n                    //Nope, it is an action so it should always be a new object. If it goes into a reactive respoitory then it will modify the actual object\r\n                    //Should I group these actions or just throw them in one at a time like I am doing\r\n                    if (score.pro != claimEdge.pro\r\n                        || score.affects != claimEdge.affects\r\n                        || score.priority != claimEdge.priority\r\n                        ) {\r\n                        const action = new Action({\r\n                            pro: claimEdge.pro,\r\n                            affects: claimEdge.affects,\r\n                            priority: claimEdge.priority,\r\n                        }, score, \"modify_score\", score.id)\r\n                        scoreActions.push(action);\r\n                        await repository.notify([action]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (action.type == 'delete_claimEdge') {\r\n            const oldClaimEdge = action.oldData as ClaimEdge;\r\n            claimIdsToScore.push(oldClaimEdge.parentId)\r\n        }\r\n\r\n        if (action.type == 'add_scoreTree') {\r\n            const scoreTree = action.newData as ScoreTree;\r\n            ScoreTreeIds.push(scoreTree.id)\r\n        }\r\n\r\n    }\r\n\r\n    //Walk up the scores for each claim to the top\r\n    for (const claimId of claimIdsToScore) {\r\n        for (const claimScore of await repository.getScoresBySourceId(claimId)) {\r\n            ScoreTreeIds.push(claimScore.scoreTreeId)\r\n        }\r\n    }\r\n\r\n    //Re-calc all Score Trees with possible changed claims\r\n\r\n    for (const scoreTreeId of ScoreTreeIds) {\r\n        const scoreTree = await repository.getScoreTree(scoreTreeId)\r\n        if (scoreTree) {\r\n            const missingScoreActions: Action[] = [];\r\n\r\n            let mainScore = await repository.getScore(scoreTree.topScoreId);\r\n            if (!mainScore) {\r\n                mainScore = new Score(scoreTree.sourceClaimId, scoreTree.id);\r\n                mainScore.id = scoreTree.topScoreId;\r\n                missingScoreActions.push(new Action(mainScore, undefined, \"add_score\"));\r\n            }\r\n\r\n            await createBlankMissingScores(repository, scoreTree.topScoreId, scoreTree.sourceClaimId || \"\", missingScoreActions, scoreTreeId)\r\n            if (missingScoreActions.length > 0) {\r\n                await repository.notify(missingScoreActions)\r\n            }\r\n\r\n            const scoreTreeActions: Action[] = [];\r\n            const newMainScore = await calculateScoreDescendants(repository, mainScore, calculator, scoreTreeActions);\r\n            if (missingScoreActions.length > 0) {\r\n                await repository.notify(scoreTreeActions)\r\n            }\r\n\r\n            const fractionActions: Action[] = [];\r\n            await calculateFractions(repository, mainScore, fractionActions)\r\n            if (fractionActions.length > 0) {\r\n                await repository.notify(fractionActions)\r\n            }\r\n\r\n            const generationActions: Action[] = [];\r\n            await calculateGenerations(repository, mainScore.id, generationActions, 0)\r\n            if (generationActions.length > 0) {\r\n                await repository.notify(generationActions)\r\n            }\r\n\r\n            scoreActions.push(\r\n                ...missingScoreActions,\r\n                ...scoreTreeActions,\r\n                ...fractionActions,\r\n                ...generationActions,\r\n            )\r\n\r\n            if (scoreTree.descendantCount != newMainScore.descendantCount) {\r\n                let newScoreTreePartial: Partial<ScoreTree> = { descendantCount: newMainScore.descendantCount }\r\n                let oldScoreTreePartial: Partial<ScoreTree> = { descendantCount: scoreTree.descendantCount }\r\n                scoreActions.push(\r\n                    new Action(newScoreTreePartial, oldScoreTreePartial, \"modify_scoreTree\", scoreTree.id)\r\n                )\r\n            }\r\n        }\r\n    }\r\n\r\n    //TODO: Review this decision: Feed the score actions back into the repository so this repository is up to date in case it is used \r\n    await repository.notify(scoreActions);\r\n\r\n    return scoreActions;\r\n}\r\n\r\n//Create Blank Missing Scores\r\nasync function createBlankMissingScores(repository: iRepository, currentScoreId: string, currentClaimId: string, actions: Action[], scoreTreeId: string) {\r\n    const edges = await repository.getClaimEdgesByParentId(currentClaimId)\r\n    const scores = await repository.getChildrenByScoreId(currentScoreId)\r\n    for (const edge of edges) {\r\n        //see if there is a matching child score for the child edge\r\n        let score = scores.find(({ sourceClaimId }) => sourceClaimId === edge.childId);\r\n        if (!score) {\r\n            //Create a new Score and attach it to it's parent\r\n            const u = undefined;\r\n            score = new Score(edge.childId, scoreTreeId, currentScoreId, edge.id, undefined, edge.pro, edge.affects, u, u, u, edge.priority);\r\n            actions.push(new Action(score, undefined, \"add_score\", score.id));\r\n        }\r\n        //Recurse and through children\r\n        await createBlankMissingScores(repository, score.id, edge.childId, actions, scoreTreeId);\r\n    }\r\n}\r\n\r\n//This function assume that all scores already exist\r\nasync function calculateScoreDescendants(repository: iRepository, currentScore: Score, calculator: iCalculateScore = calculateScore, actions: Action[]) {\r\n    const oldChildScores = await repository.getChildrenByScoreId(currentScore.id)\r\n    const newChildScores: Score[] = [];\r\n    let newDescendantCount = 0;\r\n\r\n    for (const oldChildScore of oldChildScores) { //Calculate Children\r\n        //TODO: remove any scores to calculate based on formulas that exclude scores\r\n        const newScore = await calculateScoreDescendants(repository, oldChildScore, calculator, actions);\r\n        newChildScores.push(newScore);\r\n        newDescendantCount += newScore.descendantCount + 1;\r\n    }\r\n\r\n    const newScoreFragment = calculator({\r\n        childScores: newChildScores,\r\n    })\r\n\r\n    //update any newChildScores that changed\r\n    for (const newChildScore of newChildScores) {\r\n        // TODO: Is this slow accessing the data store again for this data or do we assume it is cached if it is in an external DB\r\n        const oldChildScore = await repository.getScore(newChildScore.id);\r\n        if (oldChildScore && hasItemChanged(oldChildScore, newChildScore)) {\r\n            actions.push(new Action(newChildScore, undefined, \"modify_score\"));\r\n        }\r\n    }\r\n\r\n    //TODO: Modify the newScore based on any formulas\r\n    const newScore = {\r\n        ...currentScore,\r\n        ...newScoreFragment,\r\n        descendantCount: newDescendantCount\r\n    }\r\n    if (hasItemChanged(currentScore, newScore)) {\r\n        actions.push(new Action(newScore, undefined, \"modify_score\"));\r\n    }\r\n\r\n    return newScore;\r\n}\r\n\r\nasync function calculateFractions(repository: iRepository, parentScore: Partial<Score>, actions: Action[]) {\r\n    if (parentScore.id != undefined &&\r\n        parentScore.fraction != undefined &&\r\n        parentScore.fractionSimple != undefined) {\r\n        const oldChildScores = await repository.getChildrenByScoreId(parentScore.id)\r\n\r\n        //Count up total relevance\r\n        let totalRelevance = 0\r\n        for (const oldScore of oldChildScores) {\r\n            if (oldScore.affects === \"confidence\") {\r\n                totalRelevance += oldScore.relevance\r\n            }\r\n        }\r\n        if (totalRelevance === 0) {\r\n            totalRelevance = 1;\r\n        }\r\n\r\n        for (const oldChildScore of oldChildScores) {\r\n            const newChildScore: Partial<Score> = {\r\n                ...oldChildScore,\r\n                fractionSimple: (oldChildScore.relevance / totalRelevance) * parentScore.fractionSimple,\r\n                fraction: parentScore.fraction * oldChildScore.percentOfWeight,\r\n                // parentFractionSimple: parentScore.fractionSimple,\r\n            }\r\n            if (newChildScore.fractionSimple != oldChildScore.fractionSimple ||\r\n                newChildScore.fraction != oldChildScore.fraction) {\r\n                actions.push(new Action(newChildScore, undefined, \"modify_score\"));\r\n            }\r\n            await calculateFractions(repository, newChildScore, actions);\r\n\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// TODO: factor out duplicate code of these calculate functions. maybe mae an array of items to process...\r\nasync function calculateGenerations(repository: iRepository, parentScoreId: string, actions: Action[], generation: number) {\r\n    const oldChildScores = await repository.getChildrenByScoreId(parentScoreId)\r\n    generation++;\r\n\r\n    for (const oldChildScore of oldChildScores) {\r\n        if (oldChildScore.generation != generation) {\r\n            const newChildScore = { ...oldChildScore, generation: generation }\r\n            actions.push(new Action(newChildScore, undefined, \"modify_score\"));\r\n        }\r\n        await calculateGenerations(repository, oldChildScore.id, actions, generation)\r\n    }\r\n}\r\n","import { Item } from \"../dataModels/Item\";\r\nimport { Action } from \"../dataModels/Action\";\r\nimport { ActionTypes } from \"..\";\r\n\r\n/** Compare two scores to see if they are different in what the score is.\r\n *  Just compares confidence and relavance\r\n */\r\nexport function hasItemChanged(scoreA: Item, scoreB: Item) {\r\n    return !(JSON.stringify(scoreA, Object.keys(scoreA).sort()) ===\r\n        JSON.stringify(scoreB, Object.keys(scoreB).sort()));\r\n}\r\n\r\n/** Compares two data objects and create apropriate change objects if necessary\r\n * If a property exists on old but not new, it is ignored as the new can be a partial and is not expected to have everything\r\n * If the propert exists on the new but not the old. It retunrs the property on the partialNewItem object\r\n * If the property exists on both items and has the same value, it is ignored\r\n * If the property exists on both items but the value differs, it is added to both partials in the return\r\n * If no changes are detected then undefined is returned so it can be easily checked.\r\n */\r\nexport function itemChanges(newItem: any, oldItem: any ) {\r\n    const partialOldItem: any = {};\r\n    const partialNewItem: any = {};\r\n\r\n    //Loop through the old item properties to see if they changed in the new item\r\n    for (const prop in oldItem) {\r\n        if (oldItem[prop] !== newItem[prop]) {\r\n            partialOldItem[prop] = oldItem[prop];\r\n            partialNewItem[prop] = newItem[prop];\r\n        }\r\n    }\r\n\r\n    //Loop thgout the new item properties to see if there are any new props that should be included\r\n    for (const prop in newItem) {\r\n        if (oldItem[prop] === undefined) {\r\n            partialNewItem[prop] = newItem[prop];\r\n        }\r\n    }\r\n\r\n    if (Object.keys(partialNewItem).length > 0) {\r\n        return {\r\n            partialNewItem: partialNewItem,\r\n            partialOldItem: partialOldItem\r\n        }\r\n    } else\r\n        return undefined\r\n}\r\n\r\nexport function pushActionIfChanged(actions: Action[], newItem: any, OldItem: any, type: ActionTypes, itemId?: string) {\r\n    const checkResult = itemChanges(newItem, OldItem);\r\n    if (checkResult) {\r\n        actions.push(new Action(checkResult.partialNewItem, checkResult.partialNewItem, type, itemId));\r\n    }\r\n}\r\n","import { Action } from \"../../dataModels/Action\"\r\nimport { RsData } from \"../../dataModels/RsData\"\r\nimport { Claim } from \"../../dataModels/Claim\"\r\n\r\nexport function claims(state: RsData, action: Action, reverse: boolean = false): RsData {\r\n    switch (action.type) {\r\n        case \"add_claim\":\r\n        case \"sync_claim\":\r\n        case \"modify_claim\":\r\n            {\r\n                let newItem = state.items[action.dataId] as Claim\r\n                if (!newItem){\r\n                    newItem = new Claim(\"\",\"\")\r\n                    newItem.id = action.dataId\r\n                }\r\n                newItem = {...newItem, ...action.newData}\r\n                \r\n                return {\r\n                    ...state,\r\n                    items: {\r\n                        ...state.items,\r\n                        [action.dataId]: newItem,\r\n                    }\r\n                } as RsData\r\n            }\r\n\r\n        default:\r\n            return state\r\n    }\r\n}","import { Action } from \"../../dataModels/Action\"\r\nimport { RsData, IndexArray } from \"../../dataModels/RsData\"\r\nimport { IndexReducer } from \"./IndexReducer\"\r\nimport { ClaimEdge } from \"../../dataModels/ClaimEdge\";\r\nimport { Score } from \"../../dataModels/Score\";\r\n\r\nexport function claimEdges(state: RsData, action: Action, reverse: boolean = false): RsData {\r\n    switch (action.type) {\r\n        case \"add_claimEdge\":\r\n        case \"modify_claimEdge\":\r\n        case \"sync_claimEdge\":\r\n            {\r\n                let newItem = state.items[action.dataId] as ClaimEdge\r\n                if (!newItem){\r\n                    newItem = new ClaimEdge(\"\",\"\")\r\n                    newItem.id = action.dataId\r\n                }\r\n                newItem = {...newItem, ...action.newData}\r\n\r\n                state = {\r\n                    ...state,\r\n                    items: {\r\n                        ...state.items,\r\n                        [action.dataId]: newItem,\r\n                    }\r\n                }\r\n\r\n                state = IndexReducer(state, \"claimEdgeIdsByChildId\", newItem.childId, action.dataId);\r\n                state = IndexReducer(state, \"claimEdgeIdsByParentId\", newItem.parentId, action.dataId);\r\n                return state\r\n            }\r\n        case \"delete_claimEdge\":\r\n            {\r\n                const claimEdge = state.items[action.dataId] as ClaimEdge;\r\n                //TODO: Check that I'm not deleting anythign I shouldn't or deleting something twice?\r\n                //TODO: This leaves a lot of orphaned scores and claim and claimedges\r\n                //TODO: Probably should comment what this is doing\r\n                delete state.items[action.dataId];\r\n                state = IndexDelete(state, state.claimEdgeIdsByChildId, claimEdge.childId, action.dataId);\r\n                state = IndexDelete(state, state.claimEdgeIdsByParentId, claimEdge.parentId, action.dataId);\r\n\r\n                const scoreIds = state.scoreIdsBySourceId[action.dataId]\r\n                for (const scoreId of scoreIds) {\r\n                    const score = state.items[scoreId] as Score;\r\n                    delete state.items[scoreId];\r\n                    delete state.scoreIdsBySourceId[action.dataId];\r\n                    delete state.childIdsByScoreId[scoreId];\r\n                    if (score.parentScoreId) {\r\n                        state = IndexDelete(state, state.childIdsByScoreId, score.parentScoreId, scoreId);\r\n                    }\r\n                    state = IndexDelete(state, state.scoreIdsBySourceId, score.sourceClaimId, scoreId);\r\n                }\r\n                return state\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport function IndexDelete(state: any, index: IndexArray, keyId: string, id: string): RsData {\r\n    const internalIndex = index[keyId]\r\n    const location = internalIndex.indexOf(id, 0);\r\n    if (location > -1) {\r\n        internalIndex.splice(location, 1);\r\n    }\r\n\r\n    return state;\r\n}","import { ClaimEdge } from \"../dataModels/ClaimEdge\";\r\nimport { Score } from \"../dataModels/Score\";\r\nimport { RsData } from \"../dataModels/RsData\";\r\nimport { Action } from \"../dataModels/Action\";\r\nimport { Claim } from \"../dataModels/Claim\";\r\nimport { ScoreTree } from \"../dataModels/ScoreTree\";\r\n\r\n\r\nexport class RepositoryLocalBase {\r\n\r\n    constructor(\r\n        public rsData: RsData = new RsData()\r\n    ) {\r\n    }\r\n\r\n    async getClaim(id: string): Promise<Claim | undefined> {\r\n        return this.rsData.items[id] as Claim;\r\n    }\r\n    async getClaimEdge(id: string): Promise<ClaimEdge | undefined> {\r\n        return this.rsData.items[id] as ClaimEdge;\r\n    }\r\n    async getScore(id: string): Promise<Score | undefined> {\r\n        return this.rsData.items[id] as Score;\r\n    }\r\n    async getScoreTree(id: string): Promise<ScoreTree | undefined> {\r\n        return this.rsData.items[id] as ScoreTree;\r\n    }\r\n    async getClaimEdgesByParentId(parentId: string): Promise<ClaimEdge[]> {\r\n        const claimEdgeIdStrings = this.rsData.claimEdgeIdsByParentId[parentId];\r\n        const claimEdges: ClaimEdge[] = [];\r\n        if (claimEdgeIdStrings) {\r\n            for (const claimEdgeIdString of claimEdgeIdStrings) {\r\n                const claimEdge = await this.getClaimEdge(claimEdgeIdString)\r\n                if (claimEdge) claimEdges.push(claimEdge)\r\n            }\r\n        }\r\n        return claimEdges\r\n    }\r\n    async getClaimEdgesByChildId(childId: string): Promise<ClaimEdge[]> {\r\n        const claimEdgeIdStrings = this.rsData.claimEdgeIdsByChildId[childId];\r\n        const claimEdges: ClaimEdge[] = [];\r\n        for (const claimEdgeIdString of claimEdgeIdStrings) {\r\n            const claimEdge = await this.getClaimEdge(claimEdgeIdString)\r\n            if (claimEdge) claimEdges.push(claimEdge)\r\n        }\r\n        return claimEdges\r\n    }\r\n    async getScoresBySourceId(sourceClaimId: string): Promise<Score[]> {\r\n        const scoreIdStrings = this.rsData.scoreIdsBySourceId[sourceClaimId];\r\n        const scores: Score[] = [];\r\n        if (scoreIdStrings) {\r\n            for (const scoreIdString of scoreIdStrings) {\r\n                const score = await this.getScore(scoreIdString)\r\n                if (score) scores.push(score)\r\n            }\r\n        }\r\n        return scores\r\n    }\r\n    async getChildrenByScoreId(parentScoreId: string): Promise<Score[]> {\r\n        const childIdStrings = this.rsData.childIdsByScoreId[parentScoreId];\r\n        const scores: Score[] = [];\r\n        if (childIdStrings) {\r\n            for (const scoreIdString of childIdStrings) {\r\n                const score = await this.getScore(scoreIdString)\r\n                if (score) scores.push(score)\r\n            }\r\n        }\r\n        return scores\r\n    }\r\n    async getDescendantScoresById(mainScoreId: string): Promise<Score[]> {\r\n        // TODO: This assumes no loops in the tree\r\n        const scores: Score[] = [];\r\n        const scoresToProcess = await this.getChildrenByScoreId(mainScoreId);\r\n        while (scoresToProcess.length > 0) {\r\n            const currentScore = scoresToProcess.pop();\r\n            if (currentScore) {\r\n                scores.push(currentScore);\r\n                scoresToProcess.push(...await this.getChildrenByScoreId(currentScore.id))\r\n            }\r\n        }\r\n        return scores\r\n    }\r\n    public readonly log: Action[][] = [];\r\n\r\n}","import { Action } from \"../../dataModels/Action\"\r\nimport { RsData } from \"../../dataModels/RsData\"\r\nimport { Score } from \"../../dataModels/Score\"\r\nimport { IndexReducer } from \"./IndexReducer\";\r\n\r\nexport function scores(state: RsData, action: Action, reverse: boolean = false): RsData {\r\n    switch (action.type) {\r\n        case \"add_score\":\r\n        case \"modify_score\":\r\n        case \"sync_score\":\r\n            {\r\n                let newItem = state.items[action.dataId] as Score\r\n                if (!newItem){\r\n                    newItem = new Score(\"\",\"\")\r\n                    newItem.id = action.dataId\r\n                }\r\n                newItem = {...newItem, ...action.newData}\r\n\r\n                state = {\r\n                    ...state,\r\n                    items: {\r\n                        ...state.items,\r\n                        [action.dataId]: newItem,\r\n                    }\r\n                }\r\n\r\n                //TODO: Do I need to stop recreating the state so many times in this reducer?\r\n                state = IndexReducer(state, \"childIdsByScoreId\", newItem.parentScoreId, action.dataId);\r\n                state = IndexReducer(state, \"scoreIdsBySourceId\", newItem.sourceClaimId, action.dataId);\r\n                state = IndexReducer(state, \"scoreIdsBySourceId\", newItem.sourceEdgeId, action.dataId);\r\n                return state\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\n\r\n","import { Action } from \"../../dataModels/Action\"\r\nimport { RsData } from \"../../dataModels/RsData\"\r\nimport { ScoreTree } from \"../../dataModels/ScoreTree\";\r\nimport { IndexReducer } from \"./IndexReducer\";\r\n\r\nexport function scoreTrees(state: RsData, action: Action, reverse: boolean = false): RsData {\r\n    switch (action.type) {\r\n        case \"add_scoreTree\":\r\n        case \"modify_scoreTree\":\r\n            {\r\n                let newItem = state.items[action.dataId] as ScoreTree\r\n                if (!newItem) {\r\n                    newItem = new ScoreTree(\"\", \"\")\r\n                    newItem.id = action.dataId\r\n                }\r\n                newItem = { ...newItem, ...action.newData }\r\n\r\n                state = {\r\n                    ...state,\r\n                    items: {\r\n                        ...state.items,\r\n                        [action.dataId]: newItem,\r\n                    }\r\n                }\r\n\r\n                //TODO: Do I need to stop recreating the state so many times in this reducer?\r\n                state = IndexReducer(state, \"ScoreTreeIds\", newItem.id, action.dataId);\r\n                return state as RsData\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\n\r\n","export function deepClone<T>(item: T): T{\r\n    return JSON.parse(JSON.stringify(item))\r\n}\r\n\r\n","import { RsData } from \"../dataModels/RsData\";\r\nimport { Score } from \"../dataModels/Score\";\r\n\r\nexport function selectNode(selectedId: string, rsData: RsData) {\r\n    const result: selectedStatus[] = []\r\n    result.push({ itemId: selectedId, status: \"selected\" })\r\n\r\n    // Walk up the tree and get ancestors\r\n    let lastScoreId\r\n    let parentScoreId = (rsData.items[selectedId] as Score)?.parentScoreId\r\n    while (parentScoreId != undefined) {\r\n        result.push({ itemId: parentScoreId, status: \"ancestor\" })\r\n        parentScoreId = (rsData.items[parentScoreId] as Score)?.parentScoreId\r\n    }\r\n\r\n    //get the children\r\n    const children = rsData.childIdsByScoreId[selectedId];\r\n    if (children) {\r\n        for (const childId of rsData.childIdsByScoreId[selectedId]) {\r\n            result.push({ itemId: childId, status: \"child\" })\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport type selectedStatus = {\r\n    itemId: string,\r\n    status: selectedStatuses\r\n}\r\n\r\nexport type selectedStatuses =\r\n    \"selected\" |\r\n    \"ancestor\" |\r\n    \"child\" |\r\n    \"main\"","import { ItemTypes, Affects, newId } from \"@reasonscore/core\";\r\n\r\n/**\r\n * Stores the relationship between a claim and an item (usually another claim).\r\n * This is directional as the edge points from one claim to it's parent.\r\n * This is just a data transfer object so it should have no logic in it\r\n * and only JSON compatible types string, number, object, array, boolean\r\n */\r\nexport class ClaimEdge {\r\n    type: ItemTypes = 'claimEdge'\r\n    checked: any;\r\n\r\n    constructor(\r\n        /** The ID for the parent claim this edge points to */\r\n        public parentId: string,\r\n        /** The ID for the child claim this edge points from */\r\n        public childId: string,\r\n        /** How the child affects the parent score */\r\n        public affects: Affects = 'confidence',\r\n        /** Is the child claim a pro of it's parent (false if it is a con) */\r\n        public pro: boolean = true,\r\n        public id: string = newId(),\r\n        public priority: string = \"\",\r\n    ) {\r\n    }\r\n}\r\n\r\nexport interface iClaimEdge {\r\n    type: ItemTypes\r\n\r\n    /** The ID for the parent claim this edge points to */\r\n    parentId: string,\r\n    /** The ID for the child claim this edge points from */\r\n    childId: string,\r\n    /** How the child affects the parent score */\r\n    affects: Affects,\r\n    /** Is the child claim a pro of it's parent (false if it is a con) */\r\n    pro: boolean,\r\n    id: string,\r\n    priority: string,\r\n\r\n    /** allow for other properties by external implementations */\r\n    // [others: string]: any;\r\n}","import { ItemTypes, Item, newId } from \"@reasonscore/core\";\r\n\r\nexport class Claim implements iClaim, Item {\r\n    type: ItemTypes = 'claim'\r\n    labelMin: string = \"\";\r\n    labelMid: string = \"\";\r\n    labelMax: string = \"\";\r\n    priority: string = \"\";\r\n\r\n    constructor(\r\n        public content: string = \"\",\r\n        public id: string = newId(),\r\n        public reversible: boolean = false,\r\n    ) {\r\n    }\r\n}\r\n\r\nexport interface iClaim {\r\n    type: ItemTypes,\r\n    id: string,\r\n    reversible: boolean,\r\n    content: string,\r\n\r\n    /** allow for other properties by external implementations */\r\n    // [others: string]: any;\r\n}\r\n\r\n\r\n","import React from 'react';\r\nimport { RepositoryLocalPure, calculateScoreActions, Action, Messenger } from \"@reasonscore/core\";\r\nimport { ClaimEdge } from './dataModels/ClaimEdge';\r\nimport { Claim } from './dataModels/Claim';\r\n\r\ntype MyProps = {\r\n    claimId: string,\r\n    repository: RepositoryLocalPure,\r\n    proMainContext: boolean,\r\n    handleEditClose: () => void,\r\n    messenger: Messenger,\r\n    scoreId: string,\r\n    new?: boolean,\r\n    claimEdge?: ClaimEdge\r\n};\r\n\r\ntype MyState = {\r\n    pasteClaim: string,\r\n    proMain: boolean,\r\n    claim?: Claim,\r\n    claimEdge?: ClaimEdge,\r\n};\r\n\r\nclass EditorElement extends React.Component<MyProps, MyState> {\r\n\r\n    constructor(props: MyProps) {\r\n        super(props);\r\n        this.state = {\r\n            proMain: true,\r\n            pasteClaim: \"\",\r\n        };\r\n    }\r\n\r\n    async componentDidMount() {\r\n        const newState = {} as MyState;\r\n        if (this.props.new) {\r\n            newState.claim = new Claim();\r\n            newState.claimEdge = new ClaimEdge(this.props.claimId, newState.claim.id);\r\n        } else {\r\n            const claim = await this.props.repository.getClaim(this.props.claimId) as Claim;\r\n            if (claim) {\r\n                newState.claim = claim;\r\n            }\r\n            if (this.props.claimEdge) {\r\n                newState.claimEdge = JSON.parse(JSON.stringify(this.props.claimEdge)) //TODO: Replace with deep clone function\r\n            }\r\n        }\r\n\r\n        if (newState.claimEdge) {\r\n            newState.proMain = this.props.proMainContext ? newState.claimEdge.pro : !newState.claimEdge.pro;\r\n        }\r\n\r\n        //TODO: Temp for items with blank properties. This correctes error: A component is changing an uncontrolled input of type text to be controlled\r\n        if (newState.claim) {\r\n            if (newState.claim.labelMin === undefined) { newState.claim.labelMin = \"\" }\r\n            if (newState.claim.labelMid === undefined) { newState.claim.labelMid = \"\" }\r\n            if (newState.claim.labelMax === undefined) { newState.claim.labelMax = \"\" }\r\n            if (newState.claimEdge) {\r\n                if (newState.claimEdge.priority === undefined) { newState.claim.priority = \"\" }\r\n            }\r\n        }\r\n\r\n        this.setState(newState);\r\n    }\r\n\r\n    handleSubmit = () => {\r\n        const actions: Action[] = [];\r\n        if (this.state.pasteClaim && this.state.claimEdge) {\r\n            if (this.state.claimEdge) {\r\n                const claimEdge = this.state.claimEdge;\r\n                claimEdge.childId = this.state.pasteClaim;\r\n                actions.push(\r\n                    new Action(\r\n                        this.state.claimEdge, undefined, \"add_claimEdge\"\r\n                    )\r\n                )\r\n            }\r\n        } else {\r\n            actions.push(\r\n                new Action(\r\n                    this.state.claim,\r\n                    undefined, this.props.new ? \"add_claim\" : \"modify_claim\"\r\n                )\r\n            )\r\n            if (this.state.claimEdge) {\r\n                actions.push(new Action(\r\n                    this.state.claimEdge, undefined,\r\n                    this.props.new ? \"add_claimEdge\" : \"modify_claimEdge\"\r\n                ))\r\n            }\r\n        }\r\n\r\n        calculateScoreActions({\r\n            actions: actions,\r\n            repository: this.props.repository\r\n        }).then(async (scoreActions) => {\r\n            await this.props.messenger.notify(actions.concat(scoreActions));\r\n            this.props.handleEditClose();\r\n        });\r\n    }\r\n\r\n    handleText = (e: React.FormEvent<HTMLInputElement> |\r\n        React.FormEvent<HTMLTextAreaElement> |\r\n        React.FormEvent<HTMLSelectElement>) => {\r\n        const pathParts = e.currentTarget.id.split(\".\");\r\n        const state = this.state as any;\r\n        if (pathParts.length === 2) {\r\n            this.setState({\r\n                [pathParts[0]]: {\r\n                    ...state[pathParts[0]],\r\n                    [pathParts[1]]: e.currentTarget.value\r\n                }\r\n            } as any);\r\n        } else if (pathParts.length === 1) {\r\n            this.setState({\r\n                [pathParts[0]]: e.currentTarget.value\r\n            } as any);\r\n        } else {\r\n            throw new Error(\"id expectes 1 or 2 items in path. \" + pathParts.length + \" were received.\");\r\n        }\r\n\r\n    }\r\n\r\n    handlePriority = (e: React.FormEvent<HTMLInputElement>) => {\r\n        this.setState({ claimEdge: { \r\n            ...this.state.claimEdge,\r\n            priority: e.currentTarget.value\r\n         } as any });\r\n    }\r\n\r\n    handlePasteClaim = (e: React.FormEvent<HTMLInputElement>) => {\r\n        this.setState({ pasteClaim: e.currentTarget.value });\r\n    }\r\n\r\n    handlePro = (e: React.FormEvent<HTMLInputElement>) => {\r\n        let proMain = this.props.proMainContext ? e.currentTarget.checked : !e.currentTarget.checked;\r\n        this.setState({\r\n            claimEdge: {\r\n                ...this.state.claimEdge,\r\n                pro: e.currentTarget.checked,\r\n            } as any,\r\n            proMain: proMain\r\n        });\r\n    }\r\n\r\n    handleProMain = (e: React.FormEvent<HTMLInputElement>) => {\r\n        let pro = this.props.proMainContext ? e.currentTarget.checked : !e.currentTarget.checked;\r\n        this.setState({\r\n            claimEdge: {\r\n                ...this.state.claimEdge,\r\n                pro: pro,\r\n            } as any,\r\n            proMain: e.currentTarget.checked\r\n        });\r\n    }\r\n\r\n    handleDelete = async () => {\r\n        if (this.state.claimEdge) {\r\n            const actions: Action[] = [];\r\n            actions.push(\r\n                new Action(\r\n                    undefined,\r\n                    this.state.claimEdge, \"delete_claimEdge\", this.state.claimEdge.id\r\n                )\r\n            )\r\n\r\n            calculateScoreActions({\r\n                actions: actions,\r\n                repository: this.props.repository\r\n            }).then(async (scoreActions) => {\r\n                await this.props.messenger.notify(actions.concat(scoreActions));\r\n                this.props.handleEditClose();\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    handleCancel = () => {\r\n        this.props.handleEditClose();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                {\r\n                    this.state.claim &&\r\n                    <form className=\"container\">\r\n                        <div className=\"form-group\">\r\n                            <label htmlFor=\"claim.content\">Content</label>\r\n                            <textarea className=\"form-control\" id=\"claim.content\" value={this.state.claim.content} onChange={this.handleText} rows={2}></textarea>\r\n                            <small className=\"form-text text-muted\">\r\n                                For hyperlinks us <a href=\"https://commonmark.org/help/\">commonMark</a> syntax:\r\n                                This is [an example](http://example.com/) inline link.</small>\r\n                        </div>\r\n                        <div className=\"form-row  edit-lines\">\r\n                            <div className=\"form-group col-4\">\r\n                                <label htmlFor=\"claim.labelMin\">Minimum Value Label</label>\r\n                                <input type=\"text\" className=\"form-control\" id=\"claim.labelMin\" value={this.state.claim.labelMin} onChange={this.handleText}></input>\r\n                            </div>\r\n                            <div className=\"form-group col-4\">\r\n                                <label htmlFor=\"claim.labelMid\">Middle Value Label</label>\r\n                                <input type=\"text\" className=\"form-control\" id=\"claim.labelMid\" value={this.state.claim.labelMid} onChange={this.handleText}></input>\r\n                            </div>\r\n                            <div className=\"form-group col-4\">\r\n                                <label htmlFor=\"claim.labelMax\">Maximum Value Label</label>\r\n                                <input type=\"text\" className=\"form-control\" id=\"claim.labelMax\" value={this.state.claim.labelMax} onChange={this.handleText}></input>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {this.state.claimEdge &&\r\n                            < >\r\n                                <div className=\"form-row\">\r\n                                    <div className=\"form-group col-xs-4 mr-4\">\r\n                                        <div className=\"form-check\">\r\n                                            <input className=\"form-check-input\" type=\"checkbox\" id=\"claimEdge.pro\" checked={this.state.claimEdge.pro} onChange={this.handlePro} />\r\n                                            <label className=\"form-check-label\" htmlFor=\"claimEdge.pro\">Pro Parent</label>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"form-group col-xs-4\">\r\n                                        <div className=\"form-check\">\r\n                                            <input className=\"form-check-input\" type=\"checkbox\" id=\"proMain\" checked={this.state.proMain} onChange={this.handleProMain} />\r\n                                            <label className=\"form-check-label\" htmlFor=\"proMain\">Pro Main</label>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"form-row\">\r\n                                    <div className=\"form-group col-xs-4\">\r\n                                        <label htmlFor=\"claimEdge.affects\">Affects</label>\r\n                                        <select className=\"form-control\" id=\"claimEdge.affects\" value={this.state.claimEdge.affects} onChange={this.handleText}>\r\n                                            <option value={\"confidence\"}>Confidence</option>\r\n                                            <option value={\"relevance\"}>Relevance</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className=\"form-group col-xs-4\">\r\n                                        <label htmlFor=\"claimEdge.priority\">Priority</label>\r\n                                        <input type=\"text\" className=\"form-control\" id=\"claimEdge.priority\" value={this.state.claimEdge.priority} onChange={this.handlePriority}></input>\r\n                                    </div>\r\n                                    <div className=\"form-group col-xs-4\">\r\n                                        <label htmlFor=\"pasteClaim\">Paste Claim</label>\r\n                                        <input type=\"text\" className=\"form-control\" id=\"pasteClaim\" value={this.state.pasteClaim} onChange={this.handlePasteClaim}></input>\r\n                                    </div>\r\n                                </div>\r\n                            </>\r\n                        }\r\n                        <div className=\"btn-toolbar\" role=\"toolbar\" aria-label=\"Toolbar with button groups\">\r\n                            <div className=\"btn-group mr-3\" role=\"group\" aria-label=\"Save Locally\">\r\n                                <button type=\"button\" value=\"Save Locally\" className=\"btn btn-primary\" onClick={this.handleSubmit}>Save Locally</button>\r\n                            </div>\r\n                            <div className=\"btn-group mr-3\" role=\"group\" aria-label=\"Cancel\">\r\n                                <button type=\"button\" value=\"Cancel\" className=\"btn btn-secondary\" onClick={this.handleCancel}>Cancel</button>\r\n                            </div>\r\n                            {this.props.claimEdge &&\r\n                                <div className=\"btn-group ml-5\" role=\"group\" aria-label=\"Delete\">\r\n                                    <button type=\"button\" value=\"Delete\" className=\"btn btn btn-outline-danger\" onClick={this.handleDelete}>Delete</button>\r\n                                </div>\r\n                            }\r\n                        </div>\r\n                        \r\n                        <br></br>\r\n                        <div className=\"form-row\">\r\n                            <div className=\"form-group col-6\">\r\n                                <label htmlFor=\"claim.claimId\">Claim ID</label>\r\n                                <input disabled type=\"text\" className=\"form-control\" id=\"claim.claimId\" value={this.state.claim.id} onChange={this.handleText}></input>\r\n                            </div>\r\n                            <div className=\"form-group col-6\">\r\n                                <label htmlFor=\"claim.scoreId\">Score ID</label>\r\n                                <input disabled type=\"text\" className=\"form-control\" id=\"claim.scoreId\" value={this.props.scoreId} onChange={this.handleText}></input>\r\n                            </div>\r\n                        </div>\r\n                    </form>\r\n                }</>\r\n        );\r\n    }\r\n}\r\n\r\nexport default EditorElement;","import { selectNode, RsData } from \"@reasonscore/core\";\r\n\r\nexport function selectElement(scoreId: string, rsData: RsData, settings: any) {\r\n    const selectedNodes = selectNode(scoreId, rsData);\r\n    const expander2s = window.document.getElementsByClassName('expander2') as HTMLCollectionOf<HTMLInputElement>;\r\n    for (const expander2 of expander2s) {\r\n        const expander3 = window.document.getElementById(expander2.id.replace(\"expander2\", \"expander3\")) as HTMLInputElement;\r\n        // TODO: Find feels very slow here. Should it be a dictionairy\r\n        const selectedNode = selectedNodes.find(e => e.itemId === expander2.id.substring(10, 100))\r\n        if (selectedNode) {\r\n            if (selectedNode.status === `selected`) {\r\n                expander2.checked = true;\r\n                expander3.checked = true;\r\n            } else if (selectedNode.status === `ancestor` && !settings?.selectedOnly) {\r\n                expander2.checked = false;\r\n                expander3.checked = true;\r\n            } else {\r\n                expander2.checked = false;\r\n                expander3.checked = false;\r\n            }\r\n        } else {\r\n            expander2.checked = false;\r\n            expander3.checked = false;\r\n        }\r\n    }\r\n}","import React from 'react';\r\nimport './BucketElement.scss';\r\n\r\ntype MyProps = {\r\n    percentage: number,\r\n};\r\n\r\n\r\n\r\nclass BucketElement extends React.Component<MyProps> {\r\n\r\n    constructor(props: MyProps) {\r\n        super(props);\r\n    }\r\n\r\n    render() {\r\n        let p = this.props.percentage;\r\n        if (p > 0 && p < 4) p = 4;\r\n        if (p > 95) p = 95;\r\n        return (\r\n            <div className=\"rs-bucket\">\r\n                <div className=\"rs-bucket-fill\" style={{ height: `${p}%` }}></div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default BucketElement;","import Mustache from \"mustache\";\r\nimport { Claim, Score } from \"../../core/lib\";\r\nconst commonmark: any = require('commonmark');\r\n\r\nexport function createMarkup(claim: Claim,\r\n    score?: Score,\r\n    fractionalizedScore: string = \"\",\r\n    sign: string = \"\") {\r\n\r\n    const content = Mustache.render(claim.content, { score, claim, fractionalizedScore, sign });\r\n    var reader = new commonmark.Parser({});\r\n    var writer = new commonmark.HtmlRenderer({ safe: true });\r\n    var parsed = reader.parse(content);\r\n    var html: string = writer.render(parsed)\r\n    //Add target=\"_blank\"\r\n    html = html.replace(/href=\"/g, ' target=\"_blank\" rel=\"noopener noreferrer\"  href=\"');\r\n    // rel=\"noopener noreferrer\" due to security vulnerability https://www.jitbit.com/alexblog/256/\r\n    return { __html: html };\r\n}","import React from 'react';\r\nimport { RepositoryLocalPure, Score, Messenger, Action, ScoreTree } from \"@reasonscore/core\";\r\nimport EditorElement from './EditorElement';\r\nimport { CSSTransition, TransitionGroup } from 'react-transition-group'\r\nimport { ClaimEdge } from './dataModels/ClaimEdge';\r\nimport { Claim } from './dataModels/Claim';\r\nimport { selectElement } from './selectElement';\r\nimport Mustache from 'mustache';\r\nimport BucketElement from './BucketElement';\r\nimport { createMarkup } from './creatMarkup';\r\n\r\nconst commonmark: any = require('commonmark');\r\n\r\ntype MyProps = {\r\n    scoreId: string,\r\n    repository: RepositoryLocalPure,\r\n    proMainContext: boolean,\r\n    messenger: Messenger,\r\n    settings: any,\r\n    scoreTree: ScoreTree,\r\n};\r\n\r\ntype MyState = {\r\n    childrenVisible: boolean,\r\n    editorVisible: boolean,\r\n    addMode: boolean,\r\n    score: Score,\r\n    claim: Claim,\r\n    childScores: Score[],\r\n    claimEdge?: ClaimEdge,\r\n};\r\n\r\nclass ScoreElement extends React.Component<MyProps, MyState> {\r\n\r\n    constructor(props: MyProps) {\r\n        super(props);\r\n        this.state = {\r\n            childrenVisible: false,\r\n            editorVisible: false,\r\n            addMode: false,\r\n            score: new Score(\"\", \"\"),\r\n            claim: new Claim(),\r\n            childScores: [],\r\n            claimEdge: undefined,\r\n        };\r\n        this.state.score.confidence = .5;\r\n\r\n\r\n    }\r\n\r\n    async componentDidMount() {\r\n        const score = await this.props.repository.getScore(this.props.scoreId) as Score;\r\n        let claim = new Claim() as Claim;\r\n        if (score) {\r\n            let claimEdge: ClaimEdge | undefined;\r\n            if (score.sourceEdgeId) {\r\n                claimEdge = await this.props.repository.getClaimEdge(score.sourceEdgeId) as ClaimEdge\r\n            }\r\n            const claimResult = await this.props.repository.getClaim(score.sourceClaimId);\r\n            const childScores = await this.props.repository.getChildrenByScoreId(score.id) as Score[];\r\n            if (claimResult) {\r\n                claim = claimResult as Claim;\r\n            }\r\n            this.setState({\r\n                score: score,\r\n                claim: claim,\r\n                childScores: childScores,\r\n                claimEdge: claimEdge\r\n            });\r\n        }\r\n        this.props.messenger.subscribe(this.handleDataDispatch)\r\n    }\r\n\r\n    handleChildrenVisible = () => {\r\n        selectElement(this.state.score.id, this.props.repository.rsData, this.props.settings);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.props.messenger.unsubscribe(this.handleDataDispatch)\r\n    }\r\n\r\n    handleDataDispatch = async (actions: Action[]) => {\r\n        for (const change of actions) {\r\n            const { newData, type, dataId, oldData } = change;\r\n            let newState: any = {}\r\n            if (type === \"modify_claim\" && dataId === this.state.claim.id) {\r\n                newState.claim = { ...this.state.claim, ...newData };\r\n            }\r\n\r\n            if (type === \"modify_claimEdge\" && this.state.claimEdge && dataId === this.state.claimEdge.id) {\r\n                newState.claimEdge = { ...this.state.claimEdge, ...newData };\r\n            }\r\n\r\n            if (type === \"delete_claimEdge\" && oldData.parentId === this.state.claim.id) {\r\n                newState.childScores = await this.props.repository.getChildrenByScoreId(this.state.score.id);\r\n            }\r\n\r\n            if (type === \"modify_score\" && dataId === this.state.score.id) {\r\n                newState.score = { ...this.state.score, ...newData };\r\n            }\r\n\r\n            if (type === \"add_score\" && newData.parentScoreId === this.state.score.id) {\r\n                if (this.state.childrenVisible === false) {\r\n                    newState.childrenVisible = true;\r\n                }\r\n                const childScores = await this.props.repository.getChildrenByScoreId(this.state.score.id);\r\n                newState.childScores = childScores;\r\n            }\r\n\r\n            this.setState(newState);\r\n        }\r\n    }\r\n\r\n    handleEditButtonClick = () => {\r\n        this.setState({\r\n            editorVisible: !this.state.editorVisible,\r\n            addMode: false,\r\n        });\r\n    }\r\n\r\n    handleAddButtonClick = () => {\r\n        this.setState({\r\n            addMode: true,\r\n            editorVisible: !this.state.editorVisible\r\n        });\r\n    }\r\n\r\n    handleEditClose = () => {\r\n        this.setState({\r\n            editorVisible: false\r\n        });\r\n    }\r\n\r\n    render() {\r\n        const props = this.props;\r\n        let score = this.state.score;\r\n        const claim = this.state.claim;\r\n        const childScores = this.state.childScores;\r\n        let proMain = props.proMainContext;\r\n        let scoreNumber = Math.round(score.confidence * 100)\r\n        let scoreNumberText = `${scoreNumber}%`\r\n        const settings = this.props.settings;\r\n\r\n        //Score Numbers\r\n        let confidence = score.confidence;\r\n        let fractionalizedScore: string = \"\", sign: string = \"\";\r\n        if (score) {\r\n            if (!score.pro) {\r\n                proMain = !proMain;\r\n            }\r\n            if (!claim.reversible && score.confidence < 0) {\r\n                confidence = 0;\r\n            }\r\n            scoreNumber = Math.round(confidence * score.relevance * 100)\r\n            if (score.affects === \"relevance\") {\r\n                sign = score.pro ? \"X\" : \"\";\r\n                scoreNumberText = `${(score.relevance + 1).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 1 })}`;\r\n            } else {\r\n                if (scoreNumber === 100) scoreNumber = 99;\r\n                scoreNumberText = `${scoreNumber.toString().padStart(2, \" \")}%`\r\n            }\r\n        }\r\n\r\n        //Score Description\r\n        let scoreDescription = \"\";\r\n        if (settings.scoreDescriptions) {\r\n            if (score.affects === \"relevance\") {\r\n                scoreDescription = \"Importance\";\r\n                if (score.pro) {\r\n                    scoreDescription = \"Increases \" + scoreDescription;\r\n                } else {\r\n                    scoreDescription = \"Decreases \" + scoreDescription;\r\n                }\r\n            } else {\r\n                let descriptions, trailing = \"\";\r\n                if (!score.parentScoreId) {\r\n                    descriptions = settings.scoreDescriptions.result\r\n                } else {\r\n                    descriptions = settings.scoreDescriptions.impact\r\n                    trailing = proMain ? \" Pro\" : \" Con\";\r\n                }\r\n                for (const descItem of descriptions) {\r\n                    if (score.confidence * score.relevance >= descItem.min) {\r\n                        scoreDescription = descItem.desc;\r\n                    }\r\n                }\r\n                scoreDescription += trailing + \": \";\r\n            }\r\n        }\r\n        if (!childScores.length) {\r\n            scoreDescription = \"Assumed \" + scoreDescription\r\n        }\r\n        let basedOn = \"\"\r\n        if (this.state.score.descendantCount > 0) {\r\n            basedOn = \" based on \" + this.state.score.descendantCount + \" claim\";\r\n            if (this.state.score.descendantCount > 1) basedOn += \"s\"\r\n            basedOn += \".\"\r\n        }\r\n\r\n        //Prioritize the children for the display order\r\n        //TODO: move score sorting to the repository to reduce duplicate processing\r\n        let childScoresSorted = childScores;\r\n        if (childScores.length > 1) {\r\n            childScoresSorted = childScores.sort((a: Score, b: Score) => {\r\n                // if ((a.priority === undefined || a.priority === \"\")) return 1;\r\n                // if ((b.priority === undefined || b.priority === \"\"))  return -1;\r\n                if (a.priority > b.priority) return 1;\r\n                if (a.priority < b.priority) return -1;\r\n                if (a.descendantCount > b.descendantCount) return 1;\r\n                if (b.descendantCount > a.descendantCount) return -1;\r\n                if (a.confidence > b.confidence) return 1;\r\n                if (b.confidence > a.confidence) return -1;\r\n                return 0;\r\n            });\r\n        }\r\n\r\n        const proMainText = proMain ? \"pro\" : \"con\";\r\n\r\n        if (score.affects === \"relevance\") {\r\n            sign = score.pro ? \"X\" : \"\";\r\n            fractionalizedScore += `${(score.relevance + 1).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 1 })}`;\r\n        } else {\r\n            fractionalizedScore = Math.abs(\r\n                ((score.fraction * 100) - ((1 - score.confidence) * score.fraction * 100))\r\n            ).toFixed(0);\r\n            if (fractionalizedScore === \"100\") fractionalizedScore = \"99\";\r\n            if (!score.parentScoreId) {\r\n                if (score.confidence < 0) sign = \"-\";\r\n                else sign = \" \";\r\n                fractionalizedScore += \"%\";\r\n            } else {\r\n                sign = proMain ? \"+\" : \"-\";\r\n            }\r\n        }\r\n\r\n        let scoreUrl = new URL(window.location.toString());\r\n        scoreUrl.searchParams.set(\"s\", score.id);\r\n        let scoreUrlText = `https://twitter.com/intent/tweet?text=${encodeURIComponent(scoreUrl.toString())}%20%40GulliBot`\r\n\r\n        return (\r\n            <div className={'claim-outer'}>\r\n                <input id={\"expander2-\" + score.id} type=\"checkbox\" className=\"expander2\" onChange={this.handleChildrenVisible}></input>\r\n                <input id={\"expander3-\" + score.id} type=\"checkbox\" className=\"expander3\"></input>\r\n                <div className={'claim-hider' + (score.parentScoreId ? \"\" : \" mainclaim\")}>\r\n                    <div className={'claim ' + proMainText} >\r\n                        {childScores.length > 0 &&\r\n                            <div id={\"expander-\" + (this.state.score.id)} className={\"expander\" + (this.state.childrenVisible ? \" expanded\" : \" collapsed\")} >\r\n                                <svg width=\"20px\" height=\"20px\">\r\n                                    <use href=\"#expander\" />\r\n                                </svg>\r\n                            </div>\r\n                        }\r\n                        <div className={'claim-inner'}>\r\n                            <div className=\"lines\">\r\n                                <span className=\"min\" title={claim.labelMin}>{claim.labelMin}</span>\r\n                                <span className=\"mid\" title={claim.labelMid}>{claim.labelMid}</span>\r\n                                <span className=\"max\" title={claim.labelMax}>{claim.labelMax}</span>\r\n\r\n                                <div className=\"lines-inner\">\r\n                                    <svg className=\"lines-pointer\" style={{ left: (proMain ? (confidence + 1) / 2 : 1 - (confidence + 1) / 2) * 100 + \"%\" }} height=\"20\" width=\"20\" viewBox=\"0 0 10 10\">\r\n                                        <path d=\"M 9,3 C 9,6 6,5 5,10 4,5 1,6 1,3 1,1 3,0 5,0 7,0 9,1 9,3 Z\" />\r\n                                    </svg>\r\n                                    <div className=\"tic\" style={{ left: '0%' }}></div>\r\n                                    <div className=\"tic\" style={{ left: '33.3%' }}></div>\r\n                                    <div className=\"tic\" style={{ left: '66.6%' }}></div>\r\n                                    <div className=\"tic\" style={{ left: '100%' }}></div>\r\n                                </div>\r\n                            </div>\r\n                            <label htmlFor={\"expander2-\" + score.id} className={'numbers'}\r\n                                title={scoreDescription + basedOn}>\r\n                                <span className=\"number\">\r\n                                    {(settings.showFractionalized || settings.showScore || settings.showBucket) && sign != \" \" ?\r\n                                        <span className=\"sign\">{sign}</span> : \"\"\r\n                                    }\r\n                                    {settings.showFractionalized ? fractionalizedScore : \"\"}\r\n                                    {settings.showFractionalized && settings.showScore ? \" : \" : \"\"}\r\n                                    {settings.showScore ? scoreNumberText : \"\"}\r\n                                    {settings.showBucket ? <BucketElement percentage={score.scaledWeight * 100}></BucketElement> : \"\"}\r\n                                </span>\r\n                            </label>\r\n                            <span className={'score-description'}\r\n                                title={scoreNumberText + '% confidence based on ' + basedOn}>\r\n                                {scoreDescription + basedOn}\r\n                            </span>\r\n                            <span className={'rs-content'} dangerouslySetInnerHTML={createMarkup(claim,score, fractionalizedScore,sign)}></span>\r\n                            <label className=\"more-info\" htmlFor={\"expander2-\" + score.id} >\r\n                                More info&hellip;\r\n                            </label>\r\n                        </div>\r\n                        <svg className=\"callout\" width=\"30px\" height=\"30px\">\r\n                            <use href=\"#callout\" />\r\n                        </svg>\r\n                    </div>\r\n                </div>\r\n                <div className=\"scoreInfo\">\r\n                    <span className=\"editable\">\r\n                        {scoreDescription + basedOn}\r\n                        <button onClick={this.handleEditButtonClick} className=\"btn-inline\" >edit this claim</button>\r\n                        <button onClick={this.handleAddButtonClick} className=\"btn-inline\" >add a pro or con</button>\r\n                    </span>\r\n                    {childScores.length === 0 ?\r\n                        <p>\r\n                            I assume this claim is 100% accurate because I have not been given a reason to doubt it yet. I am gullible.\r\n                            If you feel this claim is incorrect please give me your specific reasons and evidence\r\n                        on <a target=\"_blank\" href={scoreUrlText}>Twitter</a>&nbsp;\r\n                        or <a target=\"_blank\" href=\"https://www.freesuggestionbox.com/pub/djfbumi\">anonymously</a>. <a target=\"_blank\" href=\"https://GulliBot.com/score\">How I score claims</a>.\r\n                        </p> :\r\n                        <p style={{marginBottom:`0`}}>\r\n                            <a target=\"_blank\" href={scoreUrlText}>Tweet about this claim ^^</a>\r\n                        </p>\r\n                    }\r\n                    {score.scaledWeight < score.weight ? <p>\r\n                        This claim has a lower impact because other claims in this section have a higher importance. Look at the claims with higher impact to see why they are more important.\r\n                        </p> : \"\"}\r\n                </div>\r\n                <CSSTransition in={this.state.editorVisible} timeout={490} classNames=\"editor\">\r\n                    <div>\r\n                        {this.state.editorVisible &&\r\n                            <EditorElement\r\n                                claimId={claim.id}\r\n                                repository={props.repository}\r\n                                claimEdge={this.state.claimEdge}\r\n                                proMainContext={this.state.addMode ? proMain : props.proMainContext}\r\n                                handleEditClose={this.handleEditClose}\r\n                                messenger={props.messenger}\r\n                                new={this.state.addMode}\r\n                                scoreId={this.state.score.id}\r\n                            />\r\n                        }\r\n                    </div>\r\n                </CSSTransition>\r\n                <ul id={\"children-\" + (this.state.score.id)} className={'children ' + (this.state.childrenVisible ? '' : 'hide')}>\r\n                    <TransitionGroup component={null}>\r\n                        {\r\n                            childScores.length === 0 ?\r\n                                \"\"\r\n                                : childScoresSorted.map((child) => (\r\n                                    <CSSTransition\r\n                                        key={child.id}\r\n                                        timeout={5000}\r\n                                        classNames='score'>\r\n                                        <li key={child.id}>\r\n                                            <ScoreElement\r\n                                                scoreId={child.id}\r\n                                                repository={props.repository}\r\n                                                proMainContext={proMain}\r\n                                                messenger={props.messenger}\r\n                                                settings={props.settings}\r\n                                                scoreTree={props.scoreTree}\r\n                                            />\r\n                                        </li>\r\n                                    </CSSTransition>\r\n                                ))}\r\n                    </TransitionGroup>\r\n                </ul>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default ScoreElement;","\r\n\r\n    export interface IToken\r\n    {\r\n        token: string;\r\n        className: string;\r\n        sensitiveSearch: boolean;\r\n    }\r\n\r\n\r\n    export class InstantSearch \r\n    {\r\n\r\n        protected m_container: Node;\r\n        protected m_defaultClassName: string;\r\n        protected m_defaultCaseSensitivity: boolean;\r\n        protected m_highlightTokens: IToken[];\r\n\r\n\r\n        constructor(container: Node, tokens: IToken[], defaultClassName?: string, defaultCaseSensitivity?: boolean)\r\n        {\r\n            this.iterator = this.iterator.bind(this);\r\n            this.checkAndReplace = this.checkAndReplace.bind(this);\r\n            this.highlight = this.highlight.bind(this);\r\n            this.highlightNode = this.highlightNode.bind(this);    \r\n\r\n            this.m_container = container;\r\n            this.m_defaultClassName = defaultClassName || \"highlight\";\r\n            this.m_defaultCaseSensitivity = defaultCaseSensitivity || false;\r\n            this.m_highlightTokens = tokens || [{\r\n                token: \"test\",\r\n                className: this.m_defaultClassName,\r\n                sensitiveSearch: this.m_defaultCaseSensitivity\r\n            }];\r\n        }\r\n\r\n\r\n        protected checkAndReplace(node: Node)\r\n        {\r\n            // @ts-ignore\r\n            let nodeVal: string = node.nodeValue;\r\n            // @ts-ignore\r\n            let parentNode: Node = node.parentNode;\r\n            // @ts-ignore\r\n            let textNode: Text = null;\r\n\r\n            for (let i = 0, j = this.m_highlightTokens.length; i < j; i++)\r\n            {\r\n                let curToken: IToken = this.m_highlightTokens[i];\r\n                let textToHighlight: string = curToken.token;\r\n                let highlightClassName: string = curToken.className || this.m_defaultClassName;\r\n                let caseSensitive: boolean = curToken.sensitiveSearch || this.m_defaultCaseSensitivity;\r\n\r\n                let isFirst: boolean = true;\r\n                while (true)\r\n                {\r\n                    let foundIndex: number = caseSensitive ?\r\n                        nodeVal.indexOf(textToHighlight)\r\n                        : nodeVal.toLowerCase().indexOf(textToHighlight.toLowerCase());\r\n\r\n                    if (foundIndex < 0)\r\n                    {\r\n                        if (isFirst)\r\n                            break;\r\n\r\n                        if (nodeVal)\r\n                        {\r\n                            textNode = document.createTextNode(nodeVal);\r\n                            parentNode.insertBefore(textNode, node);\r\n                        } // End if (nodeVal)\r\n\r\n                        parentNode.removeChild(node);\r\n                        break;\r\n                    } // End if (foundIndex < 0)\r\n\r\n                    isFirst = false;\r\n\r\n\r\n                    let begin: string = nodeVal.substring(0, foundIndex);\r\n                    let matched: string = nodeVal.substr(foundIndex, textToHighlight.length);\r\n\r\n                    if (begin)\r\n                    {\r\n                        textNode = document.createTextNode(begin);\r\n                        parentNode.insertBefore(textNode, node);\r\n                    } // End if (begin)\r\n\r\n                    let span: HTMLSpanElement = document.createElement(\"span\");\r\n\r\n                    if (!span.classList.contains(highlightClassName))\r\n                        span.classList.add(highlightClassName);\r\n\r\n                    span.appendChild(document.createTextNode(matched));\r\n                    parentNode.insertBefore(span, node);\r\n\r\n                    nodeVal = nodeVal.substring(foundIndex + textToHighlight.length);\r\n                } // Whend\r\n\r\n            } // Next i \r\n\r\n        } // End Sub checkAndReplace \r\n\r\n\r\n        protected iterator(p: Node)\r\n        {\r\n            if (p == null)\r\n                return;\r\n\r\n            let children: Node[] = Array.prototype.slice.call(p.childNodes);\r\n\r\n            if (children.length)\r\n            {\r\n                for (let i = 0; i < children.length; i++)\r\n                {\r\n                    let cur: Node = children[i];\r\n\r\n                    // https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\r\n                    if (cur.nodeType === Node.TEXT_NODE) \r\n                    {\r\n                        this.checkAndReplace(cur);\r\n                    }\r\n                    else if (cur.nodeType === Node.ELEMENT_NODE) \r\n                    {\r\n                        this.iterator(cur);\r\n                    }\r\n                } // Next i \r\n\r\n            } // End if (children.length) \r\n\r\n        } // End Sub iterator\r\n\r\n\r\n        public highlightNode(n:Node)\r\n        {\r\n            this.iterator(n);\r\n        } // End Sub highlight \r\n\r\n\r\n        public highlight()\r\n        {\r\n            this.iterator(this.m_container);\r\n        } // End Sub highlight \r\n\r\n\r\n    } // End Class InstantSearch \r\n\r\n\r\n","import React, { useEffect, useState } from 'react';\r\nimport { createMarkup } from './creatMarkup';\r\nimport { Claim, RepositoryLocalPure, RsData, Score } from \"@reasonscore/core\";\r\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\r\nimport './SearchElement.scss';\r\n//@ts-ignore\r\nimport Fuse from 'fuse.js'\r\nimport { selectElement } from './selectElement';\r\nimport { InstantSearch } from './utils/searchTools';\r\nimport { resourceUsage } from 'process';\r\n\r\ntype MyProps = {\r\n    repository: RepositoryLocalPure,\r\n    mainScoreId: string,\r\n};\r\n\r\nconst SearchIndex = new Fuse([], {\r\n    // isCaseSensitive: false,\r\n    includeScore: true,\r\n    shouldSort: true,\r\n    includeMatches: true,\r\n    findAllMatches: false,\r\n    minMatchCharLength: 3,\r\n    // location: 0,\r\n    // threshold: .2,\r\n    // distance: 100,\r\n    useExtendedSearch: true,\r\n    ignoreLocation: true,\r\n    // ignoreFieldNorm: false,\r\n    keys: [\r\n        \"content\",\r\n    ]\r\n});\r\n\r\nlet indexPopulated = false;\r\n\r\nconst SearchElement = ({ repository, mainScoreId }: MyProps) => {\r\n    const [searchText, setSearchText] = useState(\"\");\r\n    const [foundClaims, setFoundClaims] = useState<{ claim: Claim, score: Score, searchResult: any }[]>([]);\r\n    const [forcedRender, forceRender] = useState(.5); // TODO: Really hacky force refresh so highlights update\r\n\r\n    const handleText = async (e: React.FormEvent<HTMLInputElement>) => {\r\n        const searchText = e.currentTarget.value;\r\n        setSearchText(searchText);\r\n\r\n        // If the search index hasn't been populated then populate it now. lazy loading after they indicated they want to search.\r\n        if (!indexPopulated) {\r\n            indexPopulated = true;\r\n            for (const score of (await repository.getDescendantScoresById(mainScoreId))) {\r\n                const claim = await repository.getClaim(score.sourceClaimId);\r\n                if (claim) {\r\n                    // @ts-ignore\r\n                    SearchIndex.add({ id: claim.id, content: claim.content })\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        // Perform that search\r\n        if (searchText.length > 2) {\r\n            const items: { claim: Claim, score: Score, searchResult: any }[] = [];\r\n            const searchResults: any[] = SearchIndex.search({ content: searchText });\r\n            for (const searchResult of searchResults) {\r\n                searchResult.foundWord = getFoundWord(searchResult.matches, searchText);\r\n                if (searchResult.score < .82) {\r\n                    const claim = await repository.getClaim(searchResult.item.id);\r\n                    const score = (await repository.getScoresBySourceId(searchResult.item.id))[0];\r\n                    if (claim && score) {\r\n                        items.push({ claim: claim, score: score, searchResult: searchResult });\r\n                    }\r\n                }\r\n            }\r\n            setFoundClaims(items);\r\n            forceRender(Math.random());\r\n        } else if (foundClaims.length) {\r\n            setFoundClaims([]);\r\n        }\r\n    }\r\n\r\n\r\n    const handleOpenButtonClick = (scoreid: string) => {\r\n        selectElement(scoreid, repository.rsData, {})\r\n        document.getElementById(\"children-\" + scoreid)?.scrollIntoView()\r\n    }\r\n\r\n    const getScoreUrl = (score: Score) => {\r\n        if (score) {\r\n            // TODO: Similar to code on SearchElement\r\n            let scoreUrl = new URL(window.location.toString());\r\n            scoreUrl.searchParams.set(\"s\", score.id);\r\n            return scoreUrl.toString();\r\n        }\r\n    }\r\n\r\n    const getFoundWord = (matches: any, searchText: string) => {\r\n        let word: string = \"\";\r\n        let wordLengthDifference: number = 100;\r\n        for (const highlight of matches) {\r\n            for (const index of highlight.indices) {\r\n                const tempWord = highlight.value.substring(index[0], index[1] + 1);\r\n                if (tempWord === searchText){ // If an exact match is found then stop and use that\r\n                    return tempWord;\r\n                }\r\n                const tempWordLengthDiff = Math.abs(tempWord.length - searchText.length);\r\n                if (tempWordLengthDiff < wordLengthDifference) { // else, get the one closest to the length\r\n                    word = tempWord\r\n                    wordLengthDifference = tempWordLengthDiff;\r\n                }\r\n            }\r\n        }\r\n        return word\r\n    }\r\n\r\n    useEffect(() => { // Highlight found words \r\n        const elements = document.querySelectorAll('[data-highlight]')\r\n        for (const element of elements) {\r\n            let highlighter = new InstantSearch(element, [\r\n                {\r\n                    token: element.getAttribute(\"data-highlight\") || \"\", // searchText.value,\r\n                    className: \"highlight\", // this is the individual highlight class\r\n                    sensitiveSearch: false\r\n                }\r\n            ]);\r\n            highlighter.highlight();\r\n        }\r\n    });\r\n\r\n    return (\r\n        <div className=\"search\">\r\n            <form >\r\n                <div className=\"form-row \">\r\n                    <div className=\"form-group\">\r\n                        <label htmlFor=\"searchBox\">Search this analysis</label>\r\n                        <input type=\"text\" className=\"form-control\" id=\"searchBox\" value={searchText} onChange={handleText}></input>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            <div className={\"search-results-hider\" + (!foundClaims.length ? \"\" : \" hidden\")}>\r\n                <div className=\"searchResults\">\r\n                    <TransitionGroup component={null}>\r\n                        {foundClaims &&\r\n                            foundClaims.map(({ claim, score, searchResult }, index) => (\r\n                                <CSSTransition\r\n                                    key={claim.id}\r\n                                    timeout={500}\r\n                                    classNames='searchitem' >\r\n                                    <div className=\"search-result\" data-highlight={searchResult.foundWord} onClick={() => handleOpenButtonClick(score.id)}>\r\n                                        {index ? <hr></hr> : \"\"}\r\n                                        <span className={'rs-content'} dangerouslySetInnerHTML={{ __html: createMarkup(claim, score, undefined, undefined).__html + `<span style=\"display:none\">${forcedRender}</span>` }}></span>\r\n                                        {/* <br></br><a href={getScoreUrl(score)} target=\"_blank\">Open this claim in a new window</a> */}\r\n                                        &nbsp;<a className=\"searchMoreInfo\" onClick={() => handleOpenButtonClick(score.id)} target=\"_blank\">More Info&hellip;</a>\r\n                                        &nbsp;&nbsp;<small style={{ opacity: .2 }}>{100 - Math.round(searchResult.score * 100)}%</small>\r\n                                    </div>\r\n                                </CSSTransition>\r\n                            ))}\r\n                    </TransitionGroup>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SearchElement;","import React, { Component } from 'react';\r\nimport { RepositoryLocalPure, Messenger, calculateScoreActions, Action, ScoreTree, RsData } from \"@reasonscore/core\";\r\nimport ScoreElement from './ScoreElement';\r\nimport { selectElement } from './selectElement';\r\nimport SearchElement from './SearchElement';\r\n\r\ndeclare global {\r\n    interface Window {\r\n        RsDatabase: any;\r\n    }\r\n}\r\n\r\ntype MyProps = {\r\n    scoreTreeId: string,\r\n    repository: RepositoryLocalPure,\r\n    messenger: Messenger,\r\n    settings: any,\r\n    selectId?: string | null,\r\n};\r\n\r\ntype MyState = {\r\n    settings: {\r\n        [others: string]: boolean;\r\n    }\r\n    settingsOpen: boolean,\r\n    scoreTree?: ScoreTree,\r\n    tempVisualLog: string,\r\n};\r\n\r\nclass Menu extends Component<MyProps, MyState> {\r\n\r\n    constructor(props: MyProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            settings: {\r\n                ...{\r\n                    numbers: false,\r\n                    showFractionalized: false,\r\n                    showScore: false,\r\n                    showBucket: true,\r\n                    lines: true,\r\n                    hideMainScore: false,\r\n                    search: true,\r\n                    scoreDescriptions: {\r\n                        impact: [\r\n                            { min: -10, desc: \"Myth\" },\r\n                            { min: -.1, desc: \"Unsupported\" },\r\n                            { min: .1, desc: \"Weak\" },\r\n                            { min: .5, desc: \"\" },\r\n                            { min: .9, desc: \"Srong\" },\r\n                            { min: 1.1, desc: \"Very Srong\" },\r\n                        ],\r\n                        result: [\r\n                            { min: -10, desc: \"Myth\" },\r\n                            { min: -.1, desc: \"Unsupported\" },\r\n                            { min: .1, desc: \"Possible\" },\r\n                            { min: .5, desc: \"Likely\" },\r\n                            { min: .9, desc: \"Probable\" },\r\n                            { min: 1.1, desc: \"Probable\" },\r\n                        ]\r\n                    },\r\n                }, ...this.props.settings\r\n            },\r\n            settingsOpen: false,\r\n            scoreTree: undefined,\r\n            tempVisualLog: \"\",\r\n        };\r\n    }\r\n\r\n    async componentDidMount() {\r\n        const scoreTree = await this.props.repository.getScoreTree(this.props.scoreTreeId)\r\n        this.setState({\r\n            scoreTree: scoreTree,\r\n        })\r\n        this.props.messenger.subscribe(this.handleDataDispatch)\r\n\r\n        //Open the proper scores for display\r\n        // TODO: sleep hack because children may take awhile to be created. How can we do this better?\r\n        setTimeout(() => {\r\n            if (this.props.selectId) {\r\n                selectElement(this.props.selectId, this.props.repository.rsData, this.state.settings);\r\n            } else if (!this.props.settings.startClosed && scoreTree) {\r\n                selectElement(scoreTree.topScoreId, this.props.repository.rsData, this.state.settings);\r\n            }\r\n        }, 500);\r\n\r\n\r\n    }\r\n\r\n    handleDataDispatch = async (actions: Action[]) => {\r\n        for (const action of actions) {\r\n            const { newData, type, dataId } = action;\r\n            let newState: Partial<MyState> = {}\r\n            if (type === \"modify_scoreTree\" && dataId === this.state.scoreTree?.id) {\r\n                newState.scoreTree = { ...this.state.scoreTree, ...newData };\r\n            }\r\n\r\n            this.setState(newState as MyState);\r\n        }\r\n    }\r\n\r\n    handleSave = async () => {\r\n        //TODO: Save Log to databse?\r\n\r\n\r\n        // This JSON parsing also some undefineds that will cause Firestore to error out\r\n        const rsDataCleanedForTransfer = this.getRsDataCleanedForTransfer();\r\n\r\n        //Save the scores to Firebase\r\n        try {\r\n            await window.RsDatabase.doc(this.state.settings.dbCollection).set(rsDataCleanedForTransfer)\r\n            let newState: Partial<MyState> = { tempVisualLog: `${Date()}: Document successfully written!` };\r\n            this.setState(newState as MyState);\r\n        } catch (error) {\r\n            let newState: Partial<MyState> = { tempVisualLog: `${Date()}: Error writing document:${error}` };\r\n            this.setState(newState as MyState);\r\n        }\r\n    }\r\n\r\n    getRsDataCleanedForTransfer = () => {\r\n        const rsDataWithtouUndefined = JSON.parse(JSON.stringify(this.props.repository.rsData)) as RsData;\r\n        rsDataWithtouUndefined.actionsLog = [];\r\n        return rsDataWithtouUndefined;\r\n    }\r\n\r\n    handleImport = () => {\r\n        //TODO: HACKs: File Import needs to be completely re-done\r\n        const element = document.createElement('div');\r\n        element.innerHTML = '<input type=\"file\">';\r\n        const fileInput = element.firstChild as HTMLInputElement;\r\n        const that = this;\r\n        if (fileInput) {\r\n            fileInput.addEventListener('change', function () {\r\n                if (fileInput.files) {\r\n                    var file = fileInput.files[0];\r\n                    if (file.name.match(/\\.(txt|json)$/)) {\r\n                        var reader = new FileReader();\r\n\r\n                        reader.onload = async function () {\r\n                            that.props.repository.rsData = JSON.parse(reader.result as string);\r\n                            const scoreTree = that.state.scoreTree;\r\n                            that.setState({ scoreTree: undefined })\r\n                            await calculateScoreActions({\r\n                                actions: [new Action(scoreTree, undefined, \"add_scoreTree\")],\r\n                                repository: that.props.repository,\r\n                            }).then((updatedScores: any) => {\r\n                                setTimeout(function () {\r\n                                    that.setState({ scoreTree: scoreTree })\r\n                                }, 100);\r\n                            });\r\n                        }\r\n                        reader.readAsText(file);\r\n                    } else {\r\n                        alert(\"File not supported, .txt or .json files only\");\r\n                    }\r\n                }\r\n            });\r\n            fileInput.click();\r\n        }\r\n    }\r\n\r\n\r\n    handleExport = async () => {\r\n        // @ts-ignore\r\n        if (window.showSaveFilePicker) {\r\n            // @ts-ignore\r\n            const fileHandle = await window.showSaveFilePicker();\r\n            // Create a FileSystemWritableFileStream to write to.\r\n            const writable = await fileHandle.createWritable();\r\n            // Write the contents of the file to the stream.\r\n            await writable.write(JSON.stringify(this.getRsDataCleanedForTransfer()));\r\n            // Close the file and write the contents to disk.\r\n            await writable.close();\r\n        } else {\r\n            if (window.confirm(\"Please use Chrome version 91 or above to download large files. Do you want to attepmt anyay?\")) {\r\n                var hiddenElement = document.createElement('a');\r\n                hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(JSON.stringify(this.getRsDataCleanedForTransfer()));\r\n                hiddenElement.target = '_blank';\r\n                hiddenElement.download = 'rsData.json';\r\n                hiddenElement.click();\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    toggleSettings = () => {\r\n        this.setState({\r\n            settingsOpen: !this.state.settingsOpen\r\n        })\r\n    }\r\n\r\n    handleSetting = (setting: string, e: React.FormEvent<HTMLInputElement>) => {\r\n        this.setState({\r\n            ...this.state,\r\n            settings: {\r\n                ...this.state.settings,\r\n                [setting]: e.currentTarget.checked,\r\n            }\r\n        })\r\n    }\r\n\r\n    classNames() {\r\n        let classes = \"\";\r\n        for (const className in this.state.settings) {\r\n            if (this.state.settings[className]) {\r\n                classes += \"s-\" + className + \" \";\r\n            }\r\n        }\r\n        return classes;\r\n    }\r\n\r\n    render() {\r\n        const settings = this.state.settings;\r\n        return (<>\r\n            <div className={this.classNames()}>\r\n                {this.state.scoreTree &&\r\n                    <>\r\n                        <SearchElement repository={this.props.repository} mainScoreId={this.state.scoreTree.topScoreId} ></SearchElement>\r\n                        <ScoreElement\r\n                            scoreId={this.state.scoreTree.topScoreId}\r\n                            repository={this.props.repository}\r\n                            proMainContext={true}\r\n                            messenger={this.props.messenger}\r\n                            settings={this.state.settings}\r\n                            scoreTree={this.state.scoreTree}\r\n                        />\r\n                    </>\r\n                }\r\n            </div>\r\n            <div className=\"Content\">\r\n                <div style={{ maxWidth: \"600px\", margin: \"10px\", padding: \"1rem 0 .5rem 0\", opacity: .3 }} className=\"btn-toolbar justify-content-between\" role=\"toolbar\" aria-label=\"Toolbar with button groups\">\r\n                    <div className=\"btn-group mr-3\" role=\"group\" aria-label=\"Save\">\r\n                        {!settings.DbNotAvailable && settings.editable && settings.saveToCloud &&\r\n                            <button onClick={this.handleSave} type=\"button\" value=\"Submit\" className=\"btn btn-secondary\">Save to cloud</button>\r\n                        }\r\n                        {settings.portData && <>\r\n                            <button onClick={this.handleImport} type=\"button\" value=\"download\" className=\"btn btn-secondary\">Import</button>\r\n                            <button onClick={this.handleExport} type=\"button\" value=\"download\" className=\"btn btn-secondary\">Export</button>\r\n                        </>}\r\n\r\n                    </div>\r\n                    <div className=\"btn-group mr-3 float-right btn-settings\" role=\"group\" aria-label=\"Settings\">\r\n                        <svg onClick={this.toggleSettings} style={{ cursor: \"pointer\", height: \"1em\", fill: \"#aaa\", stroke: \"none\" }} viewBox=\"0 0 1280.000000 1280.000000\">\r\n                            <metadata>Created by potrace 1.15, written by Peter Selinger 2001-2017</metadata>\r\n                            <g transform=\"translate(0,1280) scale(0.1,-0.1)\">\r\n                                <path d=\"M5664 11538 c-38 -40 -55 -68 -68 -113 -19 -65 -44 -149 -70 -235 -9 -30 -74 -248 -145 -484 l-128 -429 -97 -33 c-176 -60 -334 -125 -503 -209 l-168 -83 -100 53 c-55 29 -154 82 -220 117 -66 36 -147 80 -180 98 -232 125 -441 239 -505 275 -41 22 -100 54 -131 70 l-57 29 -108 -101 c-60 -56 -315 -308 -568 -561 l-458 -460 54 -98 c30 -55 77 -139 103 -189 26 -49 62 -115 78 -145 17 -30 57 -103 89 -162 32 -60 86 -159 119 -220 34 -62 84 -156 112 -208 27 -52 56 -104 63 -115 8 -11 14 -26 14 -35 0 -8 -31 -76 -69 -150 -90 -176 -178 -385 -247 -587 -18 -50 -20 -52 -74 -68 -30 -10 -73 -23 -95 -30 -34 -11 -101 -31 -140 -41 -5 -2 -41 -12 -80 -24 -38 -12 -77 -23 -85 -25 -8 -2 -46 -13 -85 -25 -38 -12 -77 -23 -85 -25 -8 -2 -69 -20 -135 -40 -177 -53 -269 -81 -370 -110 -82 -24 -95 -31 -147 -83 l-57 -57 -1 -712 c0 -688 0 -713 19 -722 10 -6 56 -21 102 -35 46 -13 170 -50 274 -81 105 -31 197 -58 205 -60 8 -2 47 -14 85 -25 111 -34 154 -47 245 -73 113 -33 287 -85 326 -98 27 -8 34 -18 49 -67 79 -263 165 -482 275 -702 l68 -136 -52 -100 c-29 -54 -81 -151 -116 -214 -34 -63 -79 -146 -100 -185 -21 -38 -65 -119 -97 -180 -97 -177 -187 -344 -236 -436 l-46 -85 510 -510 509 -509 58 29 c31 17 91 49 132 71 82 46 409 224 535 291 44 24 134 72 200 109 66 36 152 82 191 102 l71 36 179 -90 c98 -50 240 -114 314 -143 74 -29 144 -56 155 -61 18 -7 175 -57 231 -74 14 -3 25 -19 32 -43 18 -63 66 -228 112 -377 11 -38 23 -77 25 -85 3 -13 70 -240 139 -470 13 -41 40 -132 61 -203 l38 -127 723 0 723 0 55 66 c31 36 56 68 57 72 1 13 8 37 29 107 12 39 23 77 25 85 2 8 13 47 25 85 12 39 23 77 25 85 2 8 13 44 24 80 11 36 63 211 116 390 53 179 100 332 105 340 4 8 48 28 97 44 156 50 363 137 548 229 l180 90 55 -29 c30 -16 118 -63 195 -105 125 -68 203 -110 445 -241 36 -20 119 -65 185 -100 66 -36 159 -86 206 -111 47 -26 92 -47 101 -47 18 0 1118 1103 1118 1122 0 7 -12 33 -26 58 -14 25 -45 81 -69 125 -23 44 -71 132 -105 195 -35 63 -138 255 -230 426 -93 170 -177 326 -189 345 -11 19 -21 41 -21 50 0 9 27 69 60 133 53 104 109 230 156 351 9 22 19 47 23 55 4 8 25 69 46 135 21 66 43 125 49 132 6 6 52 23 101 38 148 44 177 52 250 75 39 11 77 23 85 25 8 2 47 13 85 25 39 12 77 23 85 25 8 2 47 13 85 25 39 12 77 23 85 25 8 2 69 20 135 40 66 20 158 47 204 60 74 21 91 30 138 77 l53 52 0 722 0 722 -62 21 c-59 19 -325 98 -358 106 -8 2 -46 14 -85 25 -105 32 -151 46 -250 75 -49 15 -126 37 -170 50 -44 13 -118 35 -165 49 -47 13 -114 33 -150 45 l-65 20 -34 103 c-67 211 -195 507 -293 684 l-45 80 80 145 c43 79 99 182 124 229 57 106 223 413 360 665 24 44 51 95 60 113 l17 33 -499 499 c-275 275 -507 500 -515 500 -9 0 -24 -6 -35 -13 -11 -8 -58 -34 -105 -59 -90 -48 -253 -136 -447 -242 -65 -35 -145 -78 -178 -96 -92 -49 -169 -91 -302 -164 l-121 -66 -159 79 c-192 96 -331 153 -523 216 -80 26 -154 51 -166 55 -15 6 -26 29 -43 86 -33 117 -60 207 -161 544 -51 168 -102 341 -115 385 -13 44 -33 112 -45 150 -12 39 -23 78 -25 88 -2 9 -7 22 -10 27 -4 7 -260 10 -729 10 l-723 0 -49 -52z m981 -3342 c83 -16 89 -17 166 -35 248 -57 582 -231 789 -413 344 -302 557 -671 644 -1118 23 -119 27 -176 27 -362 0 -163 -9 -263 -30 -361 -6 -23 -13 -58 -16 -77 -13 -77 -89 -282 -150 -405 -178 -362 -407 -601 -735 -767 -355 -180 -750 -252 -1120 -203 -63 8 -126 17 -140 20 -14 3 -47 10 -75 16 -91 18 -310 97 -423 154 -560 280 -966 827 -1058 1425 -30 198 -30 501 1 650 3 14 8 41 11 60 31 174 128 426 228 593 120 200 230 324 406 456 216 163 515 302 745 346 73 14 203 35 240 39 83 9 412 -4 490 -18z\" />\r\n                            </g>\r\n                        </svg>\r\n                    </div>\r\n                    <div className=\"tempVisualLog\">{this.state.tempVisualLog}</div>\r\n                </div>\r\n                <div className={\"settings-container \" + (this.state.settingsOpen && \"show-settings\")}>\r\n                    <div className={\"settings-grid \"}>\r\n                        {Object.keys(this.state.settings).map((setting) => (\r\n                            <div key={setting}>\r\n                                {// TODO: make setting componant handle more than booleans\r\n                                    (this.state.settings[setting] === true || this.state.settings[setting] === false) &&\r\n                                    <>\r\n                                        <input type=\"checkbox\" id={'s-' + setting} checked={this.state.settings[setting]} onChange={this.handleSetting.bind(this, setting)} />\r\n                                        <label htmlFor={'s-' + setting}>{setting}</label>\r\n                                    </>\r\n                                }\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <svg style={{ display: \"none\" }}>\r\n                <symbol id=\"callout\" viewBox=\"0 0 9 9\">\r\n                    <g>\r\n                        <path d=\"m9 0h-9l9 9z\"></path>\r\n                    </g>\r\n                </symbol>\r\n            </svg>\r\n            <svg height=\"20px\" width=\"20px\" style={{ display: \"none\" }}>\r\n                <symbol id=\"expander\" viewBox=\"0 0 10 10\" >\r\n                    <g>\r\n                        <path d=\"m1 1 7 4-7 4z\" />\r\n                    </g>\r\n                </symbol>\r\n            </svg>\r\n        </>);\r\n    }\r\n}\r\n\r\nexport default Menu;","import React from 'react';\r\nimport { Messenger, RepositoryLocalPure } from \"@reasonscore/core\";\r\nimport Menu from './Menu';\r\n\r\n\r\nconst App: React.FC<{\r\n  scoreTreeId: string,\r\n  repository: RepositoryLocalPure,\r\n  messenger: Messenger,\r\n  settings: any,\r\n  selectId?: string | null,\r\n}> = ({\r\n  scoreTreeId,\r\n  repository,\r\n  messenger,\r\n  settings,\r\n  selectId\r\n}) => (\r\n      <>\r\n        <Menu repository={repository}\r\n          scoreTreeId={scoreTreeId}\r\n          messenger={messenger}\r\n          settings={settings}\r\n          selectId={selectId}>\r\n        </Menu>\r\n      </>\r\n    );\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import './custom.scss';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\nimport { RepositoryLocalPure, Messenger, calculateScoreActions, Action} from \"@reasonscore/core\";\r\n//import { Claim, ClaimEdge, ScoreTree } from \"@reasonscore/core\";\r\n\r\n// TODO: hacks below to use global window to pass objects between javascript an dtypescript. Later pass items out as well for use in vide-script and animated demos\r\ndeclare global {\r\n  interface Window {\r\n    RsDatabase: any,\r\n    RsActions: Action[],\r\n    RsSettings: any,\r\n    RsMessenger: Messenger,\r\n    RsRepository: RepositoryLocalPure,\r\n    RsCalculateScoreActions: any,\r\n  }\r\n}\r\n\r\n\r\nasync function startApp() {\r\n  const repository =  window.RsRepository? window.RsRepository : new RepositoryLocalPure();\r\n  window.RsRepository = repository;\r\n  const messenger = window.RsMessenger? window.RsMessenger : new Messenger();\r\n  window.RsMessenger = messenger;\r\n  const settings = window.RsSettings? window.RsSettings : {};\r\n  window.RsSettings = settings;\r\n  //const calculator : iCalculateScore = window.RsCalculator? window.RsCalculator : calculateScoreActions;\r\n  window.RsCalculateScoreActions = calculateScoreActions;\r\n\r\n  let doc\r\n  if (settings.dbCollection === null) {\r\n    settings.dbCollection = \"rsData\"\r\n  }\r\n\r\n\r\n  // //TODO: This is for easy testing for now\r\n  // const u = undefined, pro = true, con = false\r\n  // window.RsActions = [\r\n  //   new Action(new Claim('mainClaim', 'mainClaim'), u, 'add_claim'), new Action(new ScoreTree('mainClaim', 'mainClaim-score', u, 'ScoreTree'), u, 'add_scoreTree'),\r\n  //   new Action(new Claim('01', '01'), u, 'add_claim'), new Action(new ClaimEdge('mainClaim', '01', u, con, '01-edge'), u, 'add_claimEdge'),\r\n  //   new Action(new Claim('02', '02'), u, 'add_claim'), new Action(new ClaimEdge('mainClaim', '02', u, pro, '02-edge'), u, 'add_claimEdge'),\r\n  //   new Action(new Claim('02-1', '02-1'), u, 'add_claim'), new Action(new ClaimEdge('02', '02-1', u, pro, '02-1-edge'), u, 'add_claimEdge'),\r\n  //   new Action(new Claim('02-2', '02-2'), u, 'add_claim'), new Action(new ClaimEdge('02', '02-2', u, con, '02-2-edge'), u, 'add_claimEdge'),\r\n  //   new Action(new Claim('02-3', '02-3'), u, 'add_claim'), new Action(new ClaimEdge('02', '02-3', u, pro, '02-3-edge'), u, 'add_claimEdge'),\r\n  //   new Action(new Claim('03', '03'), u, 'add_claim'), new Action(new ClaimEdge('mainClaim', '03', u, pro, '03-edge'), u, 'add_claimEdge'),\r\n  //   new Action(new Claim('04', '04'), u, 'add_claim'), new Action(new ClaimEdge('mainClaim', '04', u, pro, '04-edge'), u, 'add_claimEdge'),\r\n  // ]\r\n\r\n  if (!window.RsActions) {\r\n    window.RsActions = [\r\n      {\r\n        \"newData\": {\r\n          \"content\": \"This is a new claim.\\n\\n.\\n* Select the \\\"edit this claim\\\" button below to change this text.\\n* Select the \\\"add a pro or con\\\" button to add additional claims.\\n* Select the \\\"Import\\\" and \\\"Export\\\" buttons at the bottom to save a copy to your device.\",\r\n          \"id\": \"mainClaim\",\r\n          \"type\": \"claim\"\r\n        },\r\n        \"type\": \"add_claim\",\r\n        \"dataId\": \"mainClaim\"\r\n      },\r\n      {\r\n        \"newData\": {\r\n          \"sourceClaimId\": \"mainClaim\",\r\n          \"topScoreId\": \"mainScore\",\r\n          \"id\": \"ScoreTree\",\r\n          \"type\": \"scoreTree\"\r\n        },\r\n        \"type\": \"add_scoreTree\",\r\n        \"dataId\": \"ScoreTree\"\r\n      },\r\n    ] as Action[] //TODO: need to correct order of params for actions to allow no old data more easily\r\n  }\r\n\r\n  //Populate the Repository\r\n  if (window.RsDatabase) {\r\n    doc = await window.RsDatabase.doc(settings.dbCollection).get()\r\n  }\r\n  if (doc && doc.exists) {\r\n    repository.rsData = doc.data();\r\n  } else if (window.RsActions) {\r\n    await repository.notify(window.RsActions)\r\n    settings.DbNotAvailable = true;\r\n  }\r\n\r\n  //Look in the HTML to see what we need to prep\r\n  //Loop through the html scores and start an app for each\r\n  const scoreElements = document.getElementsByTagName('rs-score');\r\n  for (const scoreElement of scoreElements) {\r\n    const possibleScoreId = scoreElement.getAttribute('score-tree-Id');\r\n    let scoreTreeId = \"\";\r\n    if (possibleScoreId) {\r\n      scoreTreeId = possibleScoreId;\r\n    }\r\n\r\n    //TODO: Check if the scoreTree, Score and Claim exist. If not, create them\r\n    const scoreTree = await repository.getScoreTree(scoreTreeId)\r\n    if (scoreTree) {\r\n      await calculateScoreActions({\r\n        actions: [new Action(scoreTree, undefined, \"add_scoreTree\")],\r\n        repository,\r\n      })\r\n    }\r\n\r\n    const selectId = new URL(window.location.href).searchParams.get(\"s\")\r\n\r\n    ReactDOM.render(<App\r\n      scoreTreeId={scoreTreeId}\r\n      repository={repository}\r\n      messenger={messenger}\r\n      settings={window.RsSettings}\r\n      selectId={selectId}\r\n    />, scoreElement);\r\n\r\n  }\r\n}\r\n// @ts-ignore\r\nwindow.rsStartApp = startApp\r\n//startApp();\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}